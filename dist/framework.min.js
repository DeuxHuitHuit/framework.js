/*! framework.js - v2.0.0 - 0ec4dfa - build 162 - 2018-01-15
 * https://github.com/DeuxHuitHuit/framework.js
 * Copyright (c) 2018 Deux Huit Huit (https://deuxhuithuit.com/);
 * MIT */
!function(e,r,n){"use strict";r.App=e.extend(r.App,{callback:function(r,n){try{if(a=null===(i=n),s=void 0!==i,u=!e.isArray(i),p=!!i&&!e.isNumeric(i.length),c="string"===e.type(i),l=!!i&&!!i.jquery,(a||s&&u&&(p||c||l))&&(i=[i]),n=i,e.isFunction(r))return r.apply(this,n||[]);if(e.isPlainObject(r))return r}catch(e){var t=e.stack,o=(e.message||e)+"\n"+(t||"");App.log({args:[o,e],fx:"error"})}var i,a,s,u,p,c,l}})}(jQuery,window),function(e,r,n){"use strict";var t={},o=function(r){return e.extend({init:e.noop},r)};r.App=e.extend(r.App,{components:{models:function(){return t},create:function(r,n){if(!t[r])return App.log({args:["Component %s is not found",r],fx:"error"}),o({});var i=t[r];return e.isFunction(i)?o(i.call(i,n)):(App.log({args:["Component %s is not a function",r],fx:"error"}),o({}))},exports:function(r,n,o){if(e.type(r)){if(!t[r]||o)return t[r]=n,n;App.log({args:["Overwriting component key %s is not allowed",r],fx:"error"})}else App.log({args:["`key` must be a string",r],fx:"error"});return!1}}})}(jQuery,window),function(e,r,n){"use strict";var t=!1;r.App=e.extend(r.App,{debug:function(e){return!0===e||!1===e?t=e:"!"===e&&(t=!t),t}})}(jQuery,window),function(e,r,n){"use strict";var t,o,i=(t=function(e,r){return r=r||window.navigator.userAgent,e.test(r)},o={isTablet:function(e){return o.isMobile(e)&&!o.isPhone(e)},isTablette:function(e){return this.isTablet(e)},isIos:function(e){return o.isIphone(e)||o.isIpad(e)},isIphone:function(e){return!o.isIpad(e)&&(t(/iPhone/i,e)||t(/iPod/i,e))},isIpad:function(e){return t(/iPad/i,e)},isAndroid:function(e){return t(/Android/i,e)},isAndroidPhone:function(e){return o.isAndroid(e)&&t(/mobile/i,e)},isPhone:function(e){return!o.isIpad(e)&&(o.isOtherPhone(e)||o.isAndroidPhone(e)||o.isIphone(e))},isOtherPhone:function(e){return t(/phone/i,e)},isOtherMobile:function(e){return t(/mobile/i,e)||o.isOtherPhone(e)},isMobile:function(e){return o.isIos(e)||o.isAndroid(e)||o.isOtherMobile(e)},isMsie:function(e){return t(/msie/im,e)||t(/trident/im,e)},isSafari:function(e){return!t(/Chrome/i,e)&&t(/Safari/i,e)},isFirefox:function(e){return t(/Firefox/i,e)},isEdge:function(e){return t(/Edge/i,e)},isChrome:function(e){return t(/Chrome/i,e)&&!o.isEdge()}});r.App=e.extend(r.App,{device:{detector:i,iphone:i.isIphone(),ipad:i.isIpad(),ios:i.isIos(),android:i.isAndroid(),mobile:i.isMobile(),phone:i.isPhone(),tablet:i.isTablet(),chrome:i.isChrome(),firefox:i.isFirefox(),safari:i.isSafari(),internetexplorer:i.isMsie(),edge:i.isEdge(),events:{click:"click",enter:"pointerenter",up:"pointerup",down:"pointerdown",move:"pointermove",over:"pointerover",out:"pointerout",leave:"pointerleave"}}})}(jQuery,window),function(e,r,n){"use strict";var t=function(e,r,n,o,i){n=Math.max(n||0,100),o=o||10,i=i||1;var a=App.callback(e,[i]);if(a)return App.callback(r,[a,i]);i<o&&setTimeout(t,n,e,r,n,o,i+1)};r.App=e.extend(r.App,{loaded:t})}(jQuery,window),function(e,r,n){"use strict";var t=[];r.App=e.extend(r.App,{log:function(r){if(!r)return this;var n=function(r){r.args&&!e.isArray(r.args)&&(r.args=[r.args]);var n={args:r.args||arguments,fx:r.fx||"warn",me:r.me||"App"},t=e.type(n.args[0]);return"string"!==t&&"number"!==t&&"boolean"!=t||(n.args[0]="["+n.me+"] "+n.args[0]),n}(r);return App.debug()&&(e.isFunction(console[n.fx])||(n.fx="log"),window.console[n.fx].apply?window.console[n.fx].apply(window.console,n.args):e.each(n.args,function(e,r){window.console[n.fx](r)})),t.push(n),this},logs:function(){return t}})}(jQuery,window),function(e,r,n){"use strict";var t={},o=function(r){return e.extend({actions:e.noop,init:e.noop},r)};r.App=e.extend(r.App,{modules:{models:function(){return t},exports:function(r,n,i){return e.type(r)?t[r]&&!i?App.log({args:["Overwriting module key %s is not allowed",r],fx:"error"}):t[r]=o(n):App.log({args:["`key` must be a string",r],fx:"error"}),t[r]},notify:function(r,n,o){return e.isFunction(n)&&!o&&(o=n,n=void 0),e.each(t,function(e){var t=App._callAction(this.actions,r,n,o);void 0!==t&&App.callback(o,[e,t])}),this}}})}(jQuery,window),function(e,r,n){"use strict";var t={},o={},i=function(e){var r=!1;return e?r=!0:App.log({args:"No route set.",fx:"error"}),r},a={regexp:function(e,r,n){if(e.test(r))return n()},string:function(e,r,n){var t;if(r=(r=decodeURIComponent(r)).split("#")[0],e==r)return n();0!==e.indexOf("^")&&(e="^"+e),e.indexOf("^")!==e.length-1&&(e+="$"),e.indexOf("*")&&(e=e.replace(new RegExp("\\*","gi"),".*"));try{t=new RegExp(e)}catch(r){App.log({args:["Error while creating RegExp %s.\n%s",e,r],fx:"error"})}return t&&t.test(r)?n():void 0}},s=function(r,n){var t=-1,o=function(e){return t=e,!1};return"string"!==e.type(r)?(App.log({args:"`route` must be a string",fx:"error"}),t):(~r.indexOf("?")&&(r=r.split("?")[0]),r&&n&&e.each(n,function(n,t){var i=e.type(t),s=a[i];return e.isFunction(s)?s(t,r,function(){return o(n)}):t!==r||o(n)}),t)},u=function(r){var n=null;return i(r)&&e.each(o,function(){var e=this.routes();if(~s(r,e))return n=this,!1}),n};r.App=e.extend(r.App,{pages:{_matchRoute:s,_validateRoute:i,instances:function(e){return e?o[e]:o},models:function(){return t},getPageForRoute:u,page:function(e){var r=o[e];return r||(r=u(e)),r},create:function(e,r,n){var i,a=t[r];if(a){if(!o[e.key]||n)return(i=a(e))&&(o[e.key]=i),i;App.log({args:["Overwriting page key `%s` is not allowed",e.key],fx:"error"})}else App.log({args:["Model `%s` not found",r],fx:"error"});return!1},exports:function(r,n,o){var i,a,s,u,p,c;return function(r,n,o){var i=e.type(r);if("string"!==i)App.log({args:["`key` must be a string, `%s` given (%s).",i,r],fx:"error"});else{if(!t[r]||o)return t[r]=n,n;App.log({args:["Overwriting page model key `%s` is not allowed",r],fx:"error"})}return!1}(r,(i=r,a=n,s=o,u=function(){return!0},p=function(e){App.callback(e)},c={actions:e.noop,init:e.noop,enter:p,leave:p,canEnter:u,canLeave:u},function(r){var n,t=r;if(e.isPlainObject(a))n=a;else{if(!e.isFunction(a))return App.log({args:["The exported page model must be an object or a function, `%s` given (%s)",e.type(a),a],fx:"error"}),null;if(n=a.call(this,i,t,s),!e.isPlainObject(n))return App.log({args:["The exported page model function must return an object, `%s` given (%s)",e.type(n),n],fx:"error"}),null}var o=function(){return t.key},u={key:o,loaded:function(){return!!e(o()).length},routes:function(){return t.routes},data:function(){return t}};return e.extend(!0,{},c,n,u)}),o)}}})}(jQuery,window),function(e,r,n){"use strict";var t,o,i,a=(t=/\+/g,o=/([^&=]+)=?([^&]*)/gi,i=function(e){return decodeURIComponent(e.replace(t," "))},{parse:function(e){var r,n,t={};for(""===e||e||(e=window.location.search),n=e.substring(1);r=o.exec(n);)t[i(r[1])]=i(r[2]);return t},stringify:function(n){var t=[];return e.each(n,function(e,n){n&&t.push(e+"="+r.encodeURIComponent(n))}),t.length?"?"+t.join("&"):""}});r.App=e.extend(r.App,{routing:{querystring:a}})}(jQuery,window),function(e,r,n){"use strict";var t=function(e){return{get:function(r){if(r)return e[r+=""]},set:function(r,n){var t=!1;if(r){r+="";try{e[r]=n?n+"":"",t=!0}catch(e){App.log({args:e.message,me:"Storage",fx:"error"}),t=!1}}return t},remove:function(r){var n=!1;if(r){r+="";try{e.removeItem(r),n=!0}catch(e){App.log({args:e.message,me:"Storage",fx:"error"}),n=!1}}return n},clear:function(r){var n=!1;try{if(r){for(var t=[],o=0;o<e.length;o++){var i=e.key(o);r.test(i)&&t.push(i)}for(o=0;o<t.length;o++)e.removeItem(t[o])}else e.clear();n=!0}catch(e){App.log({args:e.message,me:"Storage",fx:"error"}),n=!1}return n}}};r.App=e.extend(r.App,{storage:{factory:t,local:t(window.localStorage),session:t(window.sessionStorage)}})}(jQuery,window),function(e,r,n){"use strict";var t="body",o=!1,i=document.location.href.substring(document.location.protocol.length+2+document.location.host.length),a=null,s=null,u="",p=function(r,n,t){if(a){e.isFunction(n)&&!t&&(t=n,n=void 0);var o=App._callAction(a.actions,r,n);void 0!==o&&App.callback(t,[a.key(),o])}return this},c=function(){return o&&App.log({args:"Mediator is busy waiting for a page load.",fx:"error"}),!o},l=function(e){var r=!0;return e||(r=!1),r},g=function(e){var r=!0;return e.canEnter()||(App.log("Cannot enter page %s.",e.key()),r=!1),r},f=function(e,r,n){return p(e,r,n),App.modules.notify(e,r,n),this},d=function(r,n){var i,p,f="",d=function(){var e=a,r=function(){a=null,s=e,u=n||document.location.href.substring(document.location.protocol.length+2+document.location.host.length),e=null,App.modules.notify("page.leave",{page:s})},t=function(){a=i,App.modules.notify("page.enter",{page:i,route:f}),o=!1},p={currentPage:a,nextPage:i,leaveCurrent:r,enterNext:t,route:f,isHandled:!1};App.modules.notify("pages.requestPageTransition",p),i.isInited||(i.init(),i.isInited=!0),p.isHandled||(App.modules.notify("page.leaving",{page:e}),e.leave(r),App.modules.notify("page.entering",{page:i,route:f}),i.enter(t))};return c()&&(p=!1,a?a.canLeave()?p=!0:App.log("Cannot leave page %s.",a.key()):App.log({args:"No current page set.",fx:"error"}),p)&&("string"===e.type(r)?(i=App.pages.getPageForRoute(r),f=r):i=r,l(i)?g(i)?i===a?(App.modules.notify("pages.navigateToCurrent",{page:i,route:f}),App.log("next page is the current one")):(App.modules.notify("pages.loading",{page:i}),App.modules.notify("pages.requestBeginPageTransition",{currentPage:a,nextPage:i,route:f}),i.loaded()?(d(),App.modules.notify("pages.loaded",{elem:e(t),url:r,page:i})):(o=!0,Loader.load({url:r,priority:0,vip:!0,success:function(n,s,u){var p=function(r){try{return e(r)}catch(e){App.log({args:[e.message],fx:"error"}),App.modules.notify("pages.failedtoparse",{data:r,route:f,nextPage:i,currentPage:a})}return e()}(n),c=p.find(i.key()),g=e(t),h=p.find(t+" > [data-response-url]").attr("data-response-url");if(h&&h!=r.split("#")[0]){var A=i;if(i=App.pages.getPageForRoute(h),App.modules.notify("pages.redirected",{currentPage:a,nextPage:i,redirectedPage:A,requestedRoute:f,responseRoute:h}),App.modules.notify("pages.requestCancelPageTransition",{currentPage:a,nextPage:i,route:f}),!l(i))return App.modules.notify("pages.routeNotFound",{page:a,url:r,isRedirect:!0}),void App.log({args:['Redirected route "%s" was not found.',r],fx:"error"});c=p.find(i.key()),i===a?(App.modules.notify("pages.navigateToCurrent",{page:i,route:f,isRedirect:!0}),App.log("redirected next page is the current one")):App.modules.notify("pages.requestBeginPageTransition",{currentPage:a,nextPage:i,route:h,isRedirect:!0})}c.length?(g.append(c.css({opacity:0})),i.init(),i.isInited=!0,c.hide(),App.modules.notify("pages.loaded",{elem:g,data:n,url:r,page:i,node:c,xhr:u,status:s}),d()):(App.log({args:['Could not find "%s" in xhr data.',i.key()],fx:"error"}),o=!1,App.modules.notify("pages.notfound",{data:n,url:r,xhr:u,status:s}))},progress:function(e){var n=e.originalEvent.total,t=e.originalEvent.loaded,o=n>0?t/n:0;App.mediator.notify("pages.loadprogress",{event:e,url:r,total:n,loaded:t,percent:o})},error:function(e){App.modules.notify("pages.loaderror",{event:e,url:r})},giveup:function(e){o=!1,App.log({args:"Giving up!",me:"Loader"}),App.modules.notify("pages.loadfatalerror",{event:e,url:r})}}))):App.log({args:['Route "%s" is invalid.',r],fx:"error"}):(App.modules.notify("pages.routeNotFound",{page:a,url:r}),App.log({args:['Route "%s" was not found.',r],fx:"error"}))),this};r.App=e.extend(r.App,{_callAction:function(r,n,t){if(e.isFunction(r)&&(r=r()),r){var o=r[n];if(!e.isFunction(o)&&~n.indexOf(".")){o=r;var i=n.split(".");e.each(i,function(){return o=o[this],!!e.isPlainObject(o)})}return App.callback(o,[n,t])}},root:function(){return t},run:function(r){var n;return(n=r)&&e(n).length&&(t=n),e.each(App.modules.models(),function(){this.init()}),e.each(App.pages.instances(),function(){this.loaded()&&(this.init({firstTime:!0}),this.isInited=!0,~App.pages._matchRoute(i,this.routes())&&(a=this,s=this,App.modules.notify("page.entering",{page:a,route:i}),a.enter(function(){App.modules.notify("page.enter",{page:a,route:i})})))}),f("app.init",{page:a}),App},mediator:{_currentPage:function(e){return e&&(a=e),a},getCurrentPage:function(){return a},notify:f,notifyCurrentPage:p,goto:d,toggle:function(e,r){if(a&&c()){var n=App.pages.getPageForRoute(e);l(n)&&g(n)&&(n!==a?d(e):u?d(u):r?d(r):App.modules.notify("page.toggleNoPreviousUrl",{currentPage:n}))}return this}}})}(jQuery,window),function(e,r,n){"use strict";r.app&&r.app.device&&(e.each(["iphone","ipad","ios","android","mobile","phone","tablet","touch","chrome","firefox","safari","internetexplorer","edge"],function(r,n){App.device[n]&&e("html").addClass(n)}),e.easing.def=App.device.mobile?"linear":"easeOutQuad");r.console||(r.console={}),e.each(["assert","clear","count","debug","dir","dirxml","error","group","group","group","info","log","profile","profile","time","time","time","trace","warn"],function(n,t){r.console[t]=r.console[t]||e.noop}),r.pd=function(r,n){return r&&(e.isFunction(r.preventDefault)&&r.preventDefault(),!1!==n&&e.isFunction(r.stopPropagation)&&r.stopPropagation()),!1}}(jQuery,window),function(e,r,n){"use strict";var t;t=e.ajaxSettings.xhr,e.ajaxSetup({progress:e.noop,upload:e.noop,xhr:function(){var r=this,n=t();return n&&(e.isFunction(n.addEventListener)&&n.addEventListener("progress",function(n){r.progress(e.Event(n))},!1),n.upload&&e.isFunction(n.upload.addEventListener)&&n.upload.addEventListener("progress",function(n){r.upload(e.Event(n))},!1)),n}});var o=[],i=!1,a=null,s=function(r){return e.isPlainObject(r)||(r={url:r}),(!r.method||"GET"===r.method)&&(!!a&&a===r.url)},u=function(r){var n=-1;return e.each(o,function(e,t){return t.url!==r||(n=e,!1)}),n},p=function(e){return!0===e.cache&&(e.cache="session"),r.AppStorage&&r.AppStorage[e.cache]},c=e.noop,l=e.noop,g=function(){var r,n=o.shift(),t=e.extend({},n,(r=n,{progress:function(){App.callback.call(this,r.progress,arguments)},success:function(e){if(a=null,c(),App.callback.call(this,r.success,arguments),r.cache){var n=p(r);n&&n.set(r.url,e)}},error:function(){var e=r.vip?2:1;a=null,App.log({args:["Error loading url %s",r.url],me:"Loader"}),r.priority+=++r.retries,r.retries<=r.maxRetries*e?l(r):App.callback.call(this,r.giveup,arguments),c(),App.callback.call(this,r.error,arguments)}}));e.ajax(t),a=t.url};c=function(){o.length?g():i=!1};l=function(r,n){if(!r)return App.log({args:"No url given",me:"Loader"}),this;var t,a;if(t=r,a=n,e.isPlainObject(t)||(t={url:t}),e.isNumeric(a)&&Math.abs(a)<o.length&&(t.priority=a),(!e.isNumeric(t.priority)||Math.abs(t.priority)>o.length)&&(t.priority=o.length),e.isNumeric(t.retries)||(t.retries=0),e.isNumeric(t.maxRetries)||(t.maxRetries=2),s(r=t))return App.log({args:["Url %s is already loading",r.url],me:"Loader"}),this;if(r.cache&&function(e){var r=p(e);if(r){var n=r.get(e.url);if(n&&!1!==App.callback.call(this,e.cachehit,n))return App.callback.call(this,e.success,n),!0}return!1}(r))return this;var c,l,f,d=u(r.url);return~d?(c=r,(f=o[l=d]).priority!=c.priority&&(o.splice(l,1),o.splice(c.priority,1,c)),App.log({args:["Url %s was shifted from %s to %s",c.url,f.priority,c.priority],me:"Loader"})):(o.splice(r.priority,1,r),App.log({args:["Url %s has been insert at %s",r.url,r.priority],me:"Loader"})),i||(i=!0,g(),App.log({args:"Load worker has been started",me:"Loader"})),this},r.Loader=e.extend(r.Loader,{load:l,isLoading:s,inQueue:u,working:function(){return i}})}(jQuery,window);
//# sourceMappingURL=framework.min.js.map