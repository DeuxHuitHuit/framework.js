/*! framework.js - v2.0.0 - a82fa7cd51 - build 165 - 2019-05-30
 * https://github.com/DeuxHuitHuit/framework.js
 * Copyright (c) 2019 Deux Huit Huit (https://deuxhuithuit.com/);
 * MIT */
!function(p,e,c){"use strict";var i={},l=!1,g=[];e.App=p.extend(!0,e.App,{actions:{resolve:function(e,r,n){if(p.isFunction(e)&&(e=e()),e){var t=e[r];if(!p.isFunction(t)){var o=i[r]||r.split(".");if(o.length<2)return;i[r]=o,t=e,p.each(o,function(){return t=t[this],!!p.isPlainObject(t)})}if(p.isFunction(t))return t}},execute:function(e,t,o,i){var r,n=0,a=!1;for(l||(a=l=!0),p.isArray(e)||(e=[e]),p.isFunction(o)&&!i&&(i=o,o=c),e.forEach(function(e,r){var n=App.callback(e,[t,o]);i&&n!==c&&App.callback(i,[r,n]),p.isFunction(n)&&(n={read:null,write:n}),p.isPlainObject(n)&&p.isFunction(n.write)&&(App.debug()&&!n.key&&(n.key=t),g.push(n))});a&&g.length>n;){for(var u=g.length,s=n;s<u;s++)r=g[s],p.isFunction(r.read)&&r.read(t,o);for(s=n;s<u;s++)g[s].write(t,o);n=u}a&&(l=!1,g=[])},stack:function(){return g}}})}(jQuery,window),function(u,e,s){"use strict";e.App=u.extend(!0,e.App,{callback:function(e,r){try{if(r=function(e){var r=null===e,n=e!==s,t=!u.isArray(e),o=!!e&&!u.isNumeric(e.length),i="string"===u.type(e),a=!!e&&!!e.jquery;return(r||n&&t&&(o||i||a))&&(e=[e]),e}(r),u.isFunction(e))return e.apply(this,r||[]);if(u.isPlainObject(e))return e}catch(e){var n=e.stack,t=(e.message||e)+"\n"+(n||"");App.log({args:[t,e],fx:"error"})}return s}})}(jQuery,window),function(t,e){"use strict";function o(e){return t.extend({init:t.noop},e)}var i={};e.App=t.extend(!0,e.App,{components:{models:function(){return i},create:function(e,r){if(!i[e])return App.log({args:["Component %s is not found",e],fx:"error"}),o({});var n=i[e];return t.isFunction(n)?o(n.call(n,r)):(App.log({args:["Component %s is not a function",e],fx:"error"}),o({}))},exports:function(e,r,n){if("string"!==t.type(e))App.log({args:["`key` must be a string",e],fx:"error"});else{if(!i[e]||n)return i[e]=r;App.log({args:["Overwriting component key %s is not allowed",e],fx:"error"})}return!1}}})}(jQuery,window),function(e,r){"use strict";var n=!1;r.App=e.extend(!0,r.App,{debug:function(e){return!0===e||!1===e?n=e:"!"===e&&(n=!n),n}})}(jQuery,window),function(e,r){"use strict";var n,t=n={isTablet:function(e){return n.isMobile(e)&&!n.isPhone(e)},isTablette:function(e){return this.isTablet(e)},isIos:function(e){return n.isIphone(e)||n.isIpad(e)},isIphone:function(e){return!n.isIpad(e)&&(o(/iPhone/i,e)||o(/iPod/i,e))},isIpad:function(e){return o(/iPad/i,e)},isAndroid:function(e){return o(/Android/i,e)},isAndroidPhone:function(e){return n.isAndroid(e)&&o(/mobile/i,e)},isPhone:function(e){return!n.isIpad(e)&&(n.isOtherPhone(e)||n.isAndroidPhone(e)||n.isIphone(e))},isOtherPhone:function(e){return o(/phone/i,e)},isOtherMobile:function(e){return o(/mobile/i,e)||n.isOtherPhone(e)},isMobile:function(e){return n.isIos(e)||n.isAndroid(e)||n.isOtherMobile(e)},isMsie:function(e){return o(/msie/im,e)||o(/trident/im,e)},isSafari:function(e){return!o(/Chrome/i,e)&&o(/Safari/i,e)},isFirefox:function(e){return o(/Firefox/i,e)},isEdge:function(e){return o(/Edge/i,e)},isChrome:function(e){return o(/Chrome/i,e)&&!n.isEdge()}};function o(e,r){return r=function(e){return e||window.navigator.userAgent}(r),e.test(r)}r.App=e.extend(!0,r.App,{device:{detector:t,iphone:t.isIphone(),ipad:t.isIpad(),ios:t.isIos(),android:t.isAndroid(),mobile:t.isMobile(),phone:t.isPhone(),tablet:t.isTablet(),chrome:t.isChrome(),firefox:t.isFirefox(),safari:t.isSafari(),internetexplorer:t.isMsie(),edge:t.isEdge(),events:{click:"click",enter:"pointerenter",up:"pointerup",down:"pointerdown",move:"pointermove",over:"pointerover",out:"pointerout",leave:"pointerleave"}}})}(jQuery,window),function(t,e){"use strict";var o={};e.App=t.extend(!0,e.App,{fx:{notify:function(e,r,n){var t=o[e];return t?App.actions.execute(t,e,r,n):App.log({args:["Function key %s did not resolve to anything",e],fx:"warn"}),this},exports:function(e,r,n){return"string"!==t.type(e)?App.log({args:["`key` must be a string",e],fx:"error"}):o[e]&&!n?App.log({args:["Overwriting function key %s is not allowed",e],fx:"error"}):t.isFunction(r)?(function(e,r){if(App.debug()&&Object.defineProperty)try{Object.defineProperty(r,"name",{value:e})}catch(e){}}(r),o[e]=r):App.log({args:["Function key %s is not a function",e],fx:"error"}),o[e]}}})}(jQuery,window),function(e,r){"use strict";var a=function(e,r,n,t,o){n=Math.max(n||0,100),t=t||10,o=o||1;var i=App.callback(e,[o]);i?setTimeout(function(){App.callback(r,[i,o])},0):o<t?setTimeout(a,n,e,r,n,t,o+1):App.log&&App.log({fx:"error",args:["App.loaded timed out after %s attempts.",o]})};r.App=e.extend(!0,r.App,{loaded:a})}(jQuery,window),function(o,r){"use strict";var n;n=o.ajaxSettings.xhr,o.ajaxSetup({progress:o.noop,upload:o.noop,xhr:function(){var r=this,e=n();return e&&(o.isFunction(e.addEventListener)&&e.addEventListener("progress",function(e){r.progress(o.Event(e))},!1),e.upload&&o.isFunction(e.upload.addEventListener)&&e.upload.addEventListener("progress",function(e){r.upload(o.Event(e))},!1)),e}});function t(e){return o.isPlainObject(e)||(e={url:e}),(!e.method||"GET"===e.method)&&(!!c&&c===e.url)}function i(n){var t=-1;return o.each(s,function(e,r){return r.url!==n||(t=e,!1)}),t}function a(e){return!0===e.cache&&(e.cache="session"),r.App.storage&&r.App.storage[e.cache]}function u(){var e=s.shift(),r=o.extend({},e,function(o){return{progress:function(e){App.callback(o.progress,[e])},success:function(e,r,n){if(c=null,l(),App.callback(o.success,[e,r,n]),o.cache){var t=a(o);t&&t.set(o.url,e)}},error:function(e,r,n){var t=o.vip?2:1;c=null,App.log({fx:"error",args:["Error loading url %s: %s",o.url,r+" "+n],me:"Loader"}),o.priority+=++o.retries,400<=e.status&&e.status<500?App.callback(o.clienterror,[e.status,e,r,n]):o.retries<=o.maxRetries*t?g(o):App.callback(o.giveup,[e,r,n]),l(),App.callback(o.error,[e,r,n])}}}(e));o.ajax(r),c=r.url}var s=[],p=!1,c=null,l=o.noop,g=o.noop;l=function(){s.length?setTimeout(u,0):p=!1};g=function(e,r){if(!e)return App.log({fx:"error",args:"No url given",me:"Loader"}),this;if(e=function(e,r){return o.isPlainObject(e)||(e={url:e}),o.isNumeric(r)&&Math.abs(r)<s.length&&(e.priority=r),(!o.isNumeric(e.priority)||Math.abs(e.priority)>s.length)&&(e.priority=s.length),o.isNumeric(e.retries)||(e.retries=0),o.isNumeric(e.maxRetries)||(e.maxRetries=2),e}(e,r),t(e))return App.log({fx:"error",args:["Url %s is already loading",e.url],me:"Loader"}),this;if(e.cache&&function(e){var r=a(e);if(r){var n=r.get(e.url);if(n&&!1!==App.callback(e.cachehit,[n]))return App.callback(e.success,[n]),!0}return!1}(e))return this;var n=i(e.url);return~n?function(e,r){var n=s[r];n.priority!=e.priority&&(s.splice(r,1),s.splice(e.priority,1,e)),App.log({args:["Url %s was shifted from %s to %s",e.url,n.priority,e.priority],me:"Loader"})}(e,n):(s.splice(e.priority,1,e),App.log({fx:"info",args:["Url %s has been insert at %s",e.url,e.priority],me:"Loader"})),p||(p=!0,u(),App.log({fx:"info",args:"Load worker has been started",me:"Loader"})),this},r.App=o.extend(!0,r.App,{loader:{load:g,isLoading:t,inQueue:i,working:function(){return p}}})}(jQuery,window),function(t,e){"use strict";var r=[];e.App=t.extend(!0,e.App,{log:function(e){if(!e)return this;var n=function(e){e.args&&!t.isArray(e.args)&&(e.args=[e.args]);var r={args:e.args||arguments,fx:e.fx||"warn",me:e.me||"App"},n=t.type(r.args[0]);return"string"!==n&&"number"!==n&&"boolean"!=n||(r.args[0]="["+r.me+"] "+r.args[0]),r}(e);return App.debug()&&(t.isFunction(console[n.fx])||(n.fx="log"),window.console[n.fx].apply?window.console[n.fx].apply(window.console,n.args):t.each(n.args,function(e,r){window.console[n.fx](r)})),r.push(n),this},logs:function(){return r}})}(jQuery,window),function(g,e){"use strict";function i(){return document.location.href.substring(document.location.protocol.length+2+document.location.host.length)}function t(){return d&&App.log({args:"Mediator is busy waiting for a page load.",fx:"error"}),!d}function f(e){var r=!0;return e||(r=!1),r}function a(e){var r=!0;return e.canEnter()||(App.log({fx:"error",args:["Cannot enter page %s.",e.key()]}),r=!1),r}function u(e,r){if(A)return App.actions.resolve(A.actions,e,r);App.log({args:"Can not notify page: No current page set.",fx:"error"})}function o(s,o){function p(){function e(){A=null,v=n,h=o||i(),n=null,App.modules.notify("page.leave",{page:v})}function r(){A=c,App.modules.notify("page.enter",{page:c,route:l}),d=!1}var n=A,t={currentPage:A,nextPage:c,leaveCurrent:e,enterNext:r,route:l,isHandled:!1};App.modules.notify("pages.requestPageTransition",t),c.isInited||(c.init(),c.isInited=!0),t.isHandled||(App.modules.notify("page.leaving",{page:n}),n.leave(e),App.modules.notify("page.entering",{page:c,route:l}),c.enter(r))}var c,l="";return t()&&function(){var e=!1;return A?A.canLeave()?e=!0:App.log({args:["Cannot leave page %s.",A.key()],fx:"error"}):App.log({args:"No current page set.",fx:"error"}),e}()&&("string"===g.type(s)?(c=App.pages.getPageForRoute(s),l=s):c=s,f(c)?a(c)?c===A?(App.modules.notify("pages.navigateToCurrent",{page:c,route:l}),App.log("Next page is the current one")):(App.modules.notify("pages.loading",{page:c}),App.modules.notify("pages.requestBeginPageTransition",{currentPage:A,nextPage:c,route:l}),c.loaded()?(p(),App.modules.notify("pages.loaded",{elem:g(App.root()),url:s,page:c})):(d=!0,App.loader.load({url:s,priority:0,vip:!0,success:function(e,r,n){var t=function(r){try{return g(r)}catch(e){App.log({args:[e.message],fx:"error"}),App.modules.notify("pages.failedtoparse",{data:r,route:l,nextPage:c,currentPage:A})}return g()}(e),o=t.find(c.key()),i=g(App.root()),a=t.find(App.root()+" > [data-response-url]").attr("data-response-url");if(a&&a!=s.split("#")[0]){var u=c;if(c=App.pages.getPageForRoute(a),App.modules.notify("pages.redirected",{currentPage:A,nextPage:c,redirectedPage:u,requestedRoute:l,responseRoute:a}),App.modules.notify("pages.requestCancelPageTransition",{currentPage:A,nextPage:c,route:l}),!f(c))return App.modules.notify("pages.routeNotFound",{page:A,url:s,isRedirect:!0}),void App.log({args:['Redirected route "%s" was not found.',s],fx:"error"});o=t.find(c.key()),c===A?(App.modules.notify("pages.navigateToCurrent",{page:c,route:l,isRedirect:!0}),App.log("Redirected next page is the current one")):App.modules.notify("pages.requestBeginPageTransition",{currentPage:A,nextPage:c,route:a,isRedirect:!0})}o.length?(i.append(o.css({opacity:0})),c.init(),c.isInited=!0,o.hide(),App.modules.notify("pages.loaded",{elem:i,data:e,url:s,page:c,node:o,xhr:n,status:r}),p()):(App.log({args:['Could not find "%s" in xhr data.',c.key()],fx:"error"}),d=!1,App.modules.notify("pages.notfound",{data:e,url:s,xhr:n,status:r}))},progress:function(e){var r=e.originalEvent.total,n=e.originalEvent.loaded,t=0<r?n/r:0;App.mediator.notify("pages.loadprogress",{event:e,url:s,total:r,loaded:n,percent:t})},error:function(e){App.modules.notify("pages.loaderror",{event:e,url:s})},giveup:function(e){d=!1,App.log({args:"Giving up!",me:"Loader",fx:"error"}),App.modules.notify("pages.loadfatalerror",{event:e,url:s})}}))):App.log({args:['Route "%s" is invalid.',s],fx:"error"}):(App.modules.notify("pages.routeNotFound",{page:A,url:s}),App.log({args:['Route "%s" was not found.',s],fx:"error"}))),this}var d=!1,r=i(),A=null,v=null,h="";e.App=g.extend(!0,e.App,{mediator:{getCurrentUrl:i,getCurrentPage:function(){return A},setCurrentPage:function(e){A=e},getPreviousUrl:function(){return h},getPreviousPage:function(){return v},notify:function(e,r,n){var t=[],o=u(e,r);return o&&t.push(o),t=t.concat(App.modules.resolve(e,r)),App.actions.execute(t,e,r,n),this},notifyCurrentPage:function(e,r,n){var t=u(e,r);return t&&App.actions.execute([t],e,r,n),this},goto:o,toggle:function(e,r){if(A&&t()){var n=App.pages.getPageForRoute(e);f(n)&&a(n)&&(n!==A?o(e):h&&h!==i()?o(h):r?o(r):App.modules.notify("page.toggleNoPreviousUrl",{currentPage:n}))}return this},init:function(e){~App.pages.matchRoute(r,e.routes())&&(A&&App.log({args:["Previous current page will be changed",{currentPage:A,previousPage:v,newCurrentPage:e}],fx:"warning"}),A=e,v=v||e,App.modules.notify("page.entering",{page:A,route:r}),A.enter(function(){App.modules.notify("page.enter",{page:A,route:r})}))}}})}(jQuery,window),function(t,e){"use strict";function o(e){return t.extend({actions:t.noop,init:t.noop},e)}function i(r,n){return Object.keys(a).map(function(e){return App.actions.resolve(a[e].actions,r,n)}).filter(function(e){return!!e})}var a={};e.App=t.extend(!0,e.App,{modules:{models:function(){return a},exports:function(e,r,n){return"string"!==t.type(e)?App.log({args:["`key` must be a string",e],fx:"error"}):a[e]&&!n?App.log({args:["Overwriting module key %s is not allowed",e],fx:"error"}):a[e]=o(r),a[e]},notify:function(e,r,n){var t=i(e,r);return App.actions.execute(t,e,r,n),this},resolve:i}})}(jQuery,window),function(s,e){"use strict";function t(e){var r=!1;return e?r=!0:App.log({args:"No route set.",fx:"error"}),r}function o(o,e){function i(e){return r=e,!1}var r=-1;return"string"!==s.type(o)?App.log({args:"`route` must be a string",fx:"error"}):(~o.indexOf("?")&&(o=o.split("?")[0]),o&&e&&s.each(e,function(e,r){var n=s.type(r),t=u[n];return s.isFunction(t)?t(r,o,function(){return i(e)}):r!==o||i(e)})),r}function n(r){var n=null;return t(r)&&s.each(a,function(){var e=this.routes();if(~o(r,e))return n=this,!1}),n}var i={},a={},u={regexp:function(e,r,n){if(e.test(r))return n()},string:function(r,e,n){var t;if(r==(e=(e=decodeURIComponent(e)).split("#")[0]))return n();0!==r.indexOf("^")&&(r="^"+r),r.indexOf("^")!==r.length-1&&(r+="$"),r.indexOf("*")&&(r=r.replace(new RegExp("\\*","gi"),".*"));try{t=new RegExp(r)}catch(e){App.log({args:["Error while creating RegExp %s.\n%s",r,e],fx:"error"})}return t&&t.test(e)?n():void 0}};e.App=s.extend(!0,e.App,{pages:{matchRoute:o,validateRoute:t,instances:function(e){return e?a[e]:a},models:function(){return i},getPageForRoute:n,page:function(e){var r=a[e];return r||(r=n(e)),r},create:function(e,r,n){var t,o=i[r];if(o){if(!a[e.key]||n)return(t=o(e))&&(a[e.key]=t),t;App.log({args:["Overwriting page key `%s` is not allowed",e.key],fx:"error"})}else App.log({args:["Model `%s` not found",r],fx:"error"});return!1},exports:function(e,r,n){return function(e,r,n){var t=s.type(e);if("string"!==t)App.log({args:["`key` must be a string, `%s` given (%s).",t,e],fx:"error"});else{if(!i[e]||n)return i[e]=r;App.log({args:["Overwriting page model key `%s` is not allowed",e],fx:"error"})}return!1}(e,function(o,i,a){function e(){return!0}function r(e){App.callback(e)}var u={actions:s.noop,init:s.noop,enter:r,leave:r,canEnter:e,canLeave:e};return function(e){var r;if(s.isPlainObject(i))r=i;else{if(!s.isFunction(i))return App.log({args:["The exported page model must be an object or a function, `%s` given (%s)",s.type(i),i],fx:"error"}),null;if(r=i.call(this,o,e,a),!s.isPlainObject(r))return App.log({args:["The exported page model function must return an object, `%s` given (%s)",s.type(r),r],fx:"error"}),null}function n(){return e.key}var t={key:n,loaded:function(){return!!s(n()).length},routes:function(){return e.routes},data:function(){return e}};return s.extend(!0,{},u,r,t)}}(e,r,n),n)}}})}(jQuery,window),function(r,t){"use strict";var n,o,e=(n=/\+/g,o=/([^&=]+)=?([^&]*)/gi,{parse:function(e){var r,n,t={};for(""===e||e||(e=window.location.search),n=e.substring(1);r=o.exec(n);)t[i(r[1])]=i(r[2]);return t},stringify:function(e){var n=[];return r.each(e,function(e,r){r&&n.push(e+"="+t.encodeURIComponent(r))}),n.length?"?"+n.join("&"):""}});function i(e){return decodeURIComponent(e.replace(n," "))}t.App=r.extend(!0,t.App,{routing:{querystring:e}})}(jQuery,window),function(e,r){"use strict";function n(i){return{get:function(e){if(e)return i[e+=""]},set:function(e,r){var n=!1;if(e){e+="";try{i[e]=r?r+"":"",n=!0}catch(e){App.log({args:e.message,me:"Storage",fx:"error"}),n=!1}}return n},remove:function(e){var r=!1;if(e){e+="";try{i.removeItem(e),r=!0}catch(e){App.log({args:e.message,me:"Storage",fx:"error"}),r=!1}}return r},clear:function(e){var r=!1;try{if(e){for(var n=[],t=0;t<i.length;t++){var o=i.key(t);e.test(o)&&n.push(o)}for(t=0;t<n.length;t++)i.removeItem(n[t])}else i.clear();r=!0}catch(e){App.log({args:e.message,me:"Storage",fx:"error"}),r=!1}return r}}}r.App=e.extend(!0,r.App,{storage:{factory:n,local:n(window.localStorage),session:n(window.sessionStorage)}})}(jQuery,window),function(r,n){"use strict";var t="body";n.App=r.extend(!0,n.App,{root:function(){return t},run:function(e){return function(e){e&&r(e).length&&(t=e),r.each(App.modules.models(),function(){this.init()}),r.each(App.pages.instances(),function(){this.loaded()&&(this.init({firstTime:!0}),this.isInited=!0,App.mediator.init(this))}),App.mediator.notify("app.init",{page:App.mediator.getCurrentPage()}),App.mediator.getCurrentPage()||(App.modules.notify("app.pageNotFound"),App.log({args:"No current page set, pages will not work.",fx:"error"}))}(e),n.App}})}(jQuery,window),function(n,t){"use strict";var r;t.App&&t.App.device&&(r=n("html"),["iphone","ipad","ios","android","mobile","phone","tablet","touch","chrome","firefox","safari","internetexplorer","edge"].forEach(function(e){App.device[e]&&r.addClass(e)}),n.easing.def=App.device.mobile?"linear":"easeOutQuad");t.console||(t.console={}),n.each(["assert","clear","count","debug","dir","dirxml","error","group","group","group","info","log","profile","profile","time","time","time","trace","warn"],function(e,r){t.console[r]=t.console[r]||n.noop}),t.pd=function(e,r){return e&&(n.isFunction(e.preventDefault)&&e.preventDefault(),!1!==r&&n.isFunction(e.stopPropagation)&&e.stopPropagation()),!1}}(jQuery,window);
//# sourceMappingURL=framework.min.js.map