function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}(function(global,undefined){'use strict';var keys={};var innerCall=false;var _stack=[];var resolve=function resolve(actions,key){if(typeof actions==="function"){actions=actions()}if(!!actions){var tempFx=actions[key];if(typeof tempFx!=="function"){var paths=keys[key]||key.split(".");if(paths.length<2){return}keys[key]=paths;tempFx=actions;paths.every(function eachPath(p){tempFx=tempFx[p];if(_typeof(tempFx)!=="object"){return false}return true})}if(typeof tempFx==="function"){return tempFx}}};var execute=function execute(actions,key,data,cb){var sp=0;var outerCall=false;var read=function read(f){if(typeof f.read==="function"){f.read(key,data)}};var write=function write(f){f.write(key,data)};if(!innerCall){innerCall=true;outerCall=true}if(!Array.isArray(actions)){actions=[actions]}if(typeof data==="function"&&!cb){cb=data;data=undefined}actions.forEach(function eachAction(a,index){var retValue=App.callback(a,[key,data]);if(!!cb&&retValue!==undefined){App.callback(cb,[index,retValue])}if(typeof retValue==="function"){retValue={read:null,write:retValue}}if(_typeof(retValue)==="object"&&typeof retValue.write==="function"){if(App.debug()&&!retValue.key){retValue.key=key}_stack.push(retValue)}});while(outerCall&&_stack.length>sp){var sLen=_stack.length;for(var x=sp;x<sLen;x++){read(_stack[x])}for(var _x=sp;_x<sLen;_x++){write(_stack[_x])}sp=sLen}if(outerCall){innerCall=false;_stack=[]}};global.App=Object.assign({},global.App,{actions:{resolve:resolve,execute:execute,stack:function stack(){return _stack}}})})(window);(function(global,undefined){'use strict';var argsToArray=function argsToArray(args){var isNull=args===null;var isNotUndefined=args!==undefined;var isNotAnArray=!Array.isArray(args);var noLength=!!args&&!isNaN(args.length);var isString=typeof args==="string";if(isNull||isNotUndefined&&isNotAnArray&&(noLength||isString)){args=[args]}return args};var callback=function callback(fx,args){try{args=argsToArray(args);if(typeof fx==="function"){return fx.apply(this,args||[])}else if(_typeof(fx)==="object"){return fx}}catch(err){var stack=err.stack;var msg=(err.message||err)+"\n"+(stack||"");App.log({args:[msg,err],fx:"error"})}return undefined};global.App=Object.assign({},global.App,{callback:callback})})(window);(function(global,undefined){'use strict';var components={};var createAbstractComponent=function createAbstractComponent(){return{init:function init(){}}};var extendComponent=function extendComponent(component){return Object.assign({},createAbstractComponent(),component)};var exportComponent=function exportComponent(key,component,override){if(typeof key!=="string"){App.log({args:["`key` must be a string",key],fx:"error"})}else if(!!components[key]&&!override){App.log({args:["Overwriting component key %s is not allowed",key],fx:"error"})}else{components[key]=Object.freeze(component);return component}return false};var createComponent=function createComponent(key,options){if(!components[key]){App.log({args:["Component %s is not found",key],fx:"error"});return Object.freeze(extendComponent({}))}var c=components[key];if(typeof c!=="function"){App.log({args:["Component %s is not a function",key],fx:"error"});return Object.freeze(extendComponent({}))}return Object.freeze(extendComponent(c.call(c,options)))};global.App=Object.assign({},global.App,{components:{models:function models(){return components},create:createComponent,exports:exportComponent}})})(window);(function(global,undefined){'use strict';var isDebugging=false;var debug=function debug(value){if(value===true||value===false){isDebugging=value}else if(value==="!"){isDebugging=!isDebugging}return isDebugging};global.App=Object.assign({},global.App,{debug:debug})})(window);(function(global,undefined){'use strict';var browserDetector=function(){var getUserAgent=function getUserAgent(userAgent){if(!userAgent){return window.navigator.userAgent}return userAgent};var testUserAgent=function testUserAgent(regexp,userAgent){userAgent=getUserAgent(userAgent);return regexp.test(userAgent)};var detector={isTablet:function isTablet(userAgent){return detector.isMobile(userAgent)&&!detector.isPhone(userAgent)},isTablette:function isTablette(userAgent){return this.isTablet(userAgent)},isIos:function isIos(userAgent){return detector.isIphone(userAgent)||detector.isIpad(userAgent)},isIphone:function isIphone(userAgent){return!detector.isIpad(userAgent)&&(testUserAgent(/iPhone/i,userAgent)||testUserAgent(/iPod/i,userAgent))},isIpad:function isIpad(userAgent){return testUserAgent(/iPad/i,userAgent)},isAndroid:function isAndroid(userAgent){return testUserAgent(/Android/i,userAgent)},isAndroidPhone:function isAndroidPhone(userAgent){return detector.isAndroid(userAgent)&&testUserAgent(/mobile/i,userAgent)},isPhone:function isPhone(userAgent){return!detector.isIpad(userAgent)&&(detector.isOtherPhone(userAgent)||detector.isAndroidPhone(userAgent)||detector.isIphone(userAgent))},isOtherPhone:function isOtherPhone(userAgent){return testUserAgent(/phone/i,userAgent)},isOtherMobile:function isOtherMobile(userAgent){return testUserAgent(/mobile/i,userAgent)||detector.isOtherPhone(userAgent)},isMobile:function isMobile(userAgent){return detector.isIos(userAgent)||detector.isAndroid(userAgent)||detector.isOtherMobile(userAgent)},isMsie:function isMsie(userAgent){return testUserAgent(/msie/mi,userAgent)||testUserAgent(/trident/mi,userAgent)},isSafari:function isSafari(userAgent){return!testUserAgent(/Chrome/i,userAgent)&&testUserAgent(/Safari/i,userAgent)},isFirefox:function isFirefox(userAgent){return testUserAgent(/Firefox/i,userAgent)},isEdge:function isEdge(userAgent){return testUserAgent(/Edge/i,userAgent)||testUserAgent(/Edg/i,userAgent)},isChrome:function isChrome(userAgent){return testUserAgent(/Chrome/i,userAgent)&&!detector.isEdge()},isMacOs:function isMacOs(userAgent){return testUserAgent(/Macintosh/i,userAgent)&&!detector.isMobile()},isWindows:function isWindows(userAgent){return testUserAgent(/Windows/i,userAgent)},isLinux:function isLinux(userAgent){return testUserAgent(/Linux/i,userAgent)&&!detector.isMobile()}};return detector}();global.App=Object.assign({},global.App,{device:{detector:browserDetector,iphone:browserDetector.isIphone(),ipad:browserDetector.isIpad(),ios:browserDetector.isIos(),android:browserDetector.isAndroid(),macos:browserDetector.isMacOs(),windows:browserDetector.isWindows(),linux:browserDetector.isLinux(),mobile:browserDetector.isMobile(),phone:browserDetector.isPhone(),tablet:browserDetector.isTablet(),chrome:browserDetector.isChrome(),firefox:browserDetector.isFirefox(),safari:browserDetector.isSafari(),internetexplorer:browserDetector.isMsie(),edge:browserDetector.isEdge(),events:{click:"click",enter:"pointerenter",up:"pointerup",down:"pointerdown",move:"pointermove",over:"pointerover",out:"pointerout",leave:"pointerleave"}}})})(window);(function(global,undefined){'use strict';var bindings={};var setFxName=function setFxName(key,fx){if(!!App.debug()&&Object.defineProperty){try{Object.defineProperty(fx,"name",{value:key})}catch(ex){}}};var notify=function notify(key,data,cb){var fx=bindings[key];if(!fx){App.log({args:["Function key %s did not resolve to anything",key],fx:"warn"})}else{App.actions.execute(fx,key,data,cb)}return this};var exportsFx=function exportsFx(key,fx,override){if(typeof key!=="string"){App.log({args:["`key` must be a string",key],fx:"error"})}else if(!!bindings[key]&&!override){App.log({args:["Overwriting function key %s is not allowed",key],fx:"error"})}else if(typeof fx!=="function"){App.log({args:["Function key %s is not a function",key],fx:"error"})}else{setFxName(fx);bindings[key]=Object.freeze(fx)}return bindings[key]};global.App=Object.assign({},global.App,{fx:{notify:notify,exports:exportsFx}})})(window);(function(global,undefined){'use strict';var loaded=function loaded(v,fx,delay,maxRetriesCount,counter){delay=Math.max(delay||0,100);maxRetriesCount=maxRetriesCount||10;counter=counter||1;var value=App.callback(v,[counter]);if(!!value){window.setTimeout(function(){App.callback(fx,[value,counter])},0)}else if(counter<maxRetriesCount){window.setTimeout(loaded,delay,v,fx,delay,maxRetriesCount,counter+1)}else if(!!App.log){App.log({fx:"error",args:["App.loaded timed out after %s attempts.",counter]})}};global.App=Object.assign({},global.App,{loaded:loaded})})(window);(function(global,undefined){'use strict';var _isLoading=false;var defaultFetchOptions=function defaultFetchOptions(){return{method:"GET",mode:"cors",redirect:"follow"}};var load=function load(url){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!url){url=window.location.origin+"/"}options=Object.assign({},defaultFetchOptions(),options);return window.fetch(url,options)};global.App=Object.assign({},global.App,{loader:{load:load,isLoading:function isLoading(){return _isLoading}}})})(window);(function(global,undefined){'use strict';var argsToObject=function argsToObject(arg){if(!!arg.args&&!Array.isArray(arg.args)){arg.args=[arg.args]}var a={args:arg.args||arguments,fx:arg.fx||"warn",me:arg.me||"App"},t1=_typeof(a.args[0]);if(t1==="string"||t1==="number"||t1==="boolean"){a.args[0]="["+a.me+"] "+a.args[0]}return a};var _logs=[];var log=function log(arg){if(!arg){return this}var a=argsToObject(arg);if(App.debug()){if(typeof console[a.fx]!=="function"){a.fx="log"}if(!!window.console[a.fx].apply){window.console[a.fx].apply(window.console,a.args)}else{a.args.forEach(function logArgs(arg){window.console[a.fx](arg)})}}_logs.push(a);return this};global.App=Object.assign({},global.App,{log:log,logs:function logs(){return _logs}})})(window);(function(global,undefined){'use strict';var getCurrentUrl=function getCurrentUrl(){return document.location.pathname};var mediatorIsLoadingPage=false;var currentRouteUrl=getCurrentUrl();var currentPage=null;var previousPage=null;var previousUrl="";var validateMediatorState=function validateMediatorState(){if(!!mediatorIsLoadingPage){App.log({args:"Mediator is busy waiting for a page load.",fx:"error"})}return!mediatorIsLoadingPage};var canEnterNextPage=function canEnterNextPage(nextPage){var result=true;if(!nextPage.canEnter()){App.log({fx:"error",args:["Cannot enter page %s.",nextPage.key()]});result=false}return result};var canLeaveCurrentPage=function canLeaveCurrentPage(){var result=false;if(!currentPage){App.log({args:"No current page set.",fx:"error"})}else if(!currentPage.canLeave()){App.log({args:["Cannot leave page %s.",currentPage.key()],fx:"error"})}else{result=true}return result};var resolvePageAction=function resolvePageAction(key,data){if(!!currentPage){return App.actions.resolve(currentPage.actions,key,data)}else{App.log({args:"Can not notify page: No current page set.",fx:"error"})}};var notifyAll=function notifyAll(key,data,cb){var actions=[];var pa=resolvePageAction(key,data);if(!!pa){actions.push(pa)}actions=actions.concat(App.modules.resolve(key,data));App.actions.execute(actions,key,data,cb);return this};var notifyPage=function notifyPage(key,data,cb){var pa=resolvePageAction(key,data);if(!!pa){App.actions.execute([pa],key,data,cb)}return this};var gotoPage=function gotoPage(obj,previousPoppedUrl){var pageData=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var changeUrl=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var nextPage;var route="";var safeParseData=function safeParseData(data){try{var parser=new window.DOMParser;var doc=parser.parseFromString(data,"text/html");return doc}catch(ex){App.log({args:[ex.message],fx:"error"});App.modules.notify("pages.failedtoparse",{data:data,route:route,nextPage:nextPage,currentPage:currentPage})}return null};var enterLeave=function enterLeave(){var leavingPage=currentPage;pageData.firstTime=false;if(!nextPage.isInited()){nextPage.init();nextPage.setInited();pageData.firstTime=true}App.modules.notify("page.leaving",{page:leavingPage});leavingPage.leave(function(){currentPage=null;previousPage=leavingPage;previousUrl=!!previousPoppedUrl?previousPoppedUrl:getCurrentUrl();leavingPage=null;App.modules.notify("page.leave",{page:previousPage})});App.modules.notify("page.entering",{page:nextPage,route:route});nextPage.enter(function(){currentPage=nextPage;App.modules.notify("page.enter",{page:nextPage,route:route});mediatorIsLoadingPage=false},pageData)};var loadSuccess=function loadSuccess(response){if(!!response.redirected){window.history.replaceState({data:{mediator:true,type:"pushState",redirected:true}},"",response.url);nextPage=App.pages.getPageForHref(response.url);route=response.url;var node=document.querySelector(nextPage.selector());if(!!node){node.style.opacity=0;node.style.display="none";return enterLeave()}}return response.text().then(function(data){var htmldata=safeParseData(data);var node=htmldata.querySelector(nextPage.selector());var elem=document.querySelector(App.root());if(!node){App.log({args:["Could not find \"%s\" in xhr data.",nextPage.selector()],fx:"error"});mediatorIsLoadingPage=false;App.modules.notify("pages.notfound",{data:data,url:obj,response:response,status:response.status})}else{node.style.opacity=0;node.style.display="none";elem.appendChild(node);App.modules.notify("pages.loaded",{elem:elem,data:data,html:htmldata,url:obj,page:nextPage,node:node,response:response,status:response.status});enterLeave()}})};if(validateMediatorState()&&canLeaveCurrentPage()){if(typeof obj==="string"){nextPage=App.pages.getPageForHref(obj);route=obj}else{App.log({fx:"error",args:"Url parameter must be of type string got "+_typeof(obj)});return}if(!nextPage){App.modules.notify("pages.routeNotFound",{page:currentPage,url:obj});App.log({args:["Route \"%s\" was not found.",obj],fx:"error"})}else{if(canEnterNextPage(nextPage)){if(nextPage.key()===currentPage.key()){App.modules.notify("pages.navigateToCurrent",{page:nextPage,route:route});App.log("Next page is the current one")}else{if(!!changeUrl){window.history.pushState({data:{mediator:true}},"",obj);pageData.type="pushState"}App.modules.notify("pages.loading",{page:nextPage});App.modules.notify("pages.requestBeginPageTransition",{currentPage:currentPage,nextPage:nextPage,route:route});if(!App.pages.loaded(obj)){mediatorIsLoadingPage=true;App.loader.load(obj).then(loadSuccess).catch(function(event){App.modules.notify("pages.loaderror",{event:event,url:obj})})}else{enterLeave();App.modules.notify("pages.loaded",{elem:document.querySelector(App.root()),url:obj,page:nextPage})}}}else{App.log({args:["Route \"%s\" is invalid.",obj],fx:"error"})}}}return this};var initPage=function initPage(page){if(!!currentPage){App.log({args:["Previous current page will be changed",{currentPage:currentPage,previousPage:previousPage,newCurrentPage:page}],fx:"warning"})}currentPage=page;previousPage=previousPage||page;App.modules.notify("page.entering",{page:currentPage,route:currentRouteUrl});currentPage.enter(function currentPageEnterCallback(){App.modules.notify("page.enter",{page:currentPage,route:currentRouteUrl})},true)};global.App=Object.assign({},global.App,{mediator:{getCurrentUrl:getCurrentUrl,getCurrentPage:function getCurrentPage(){return currentPage},setCurrentPage:function setCurrentPage(page){currentPage=page},getPreviousUrl:function getPreviousUrl(){return previousUrl},getPreviousPage:function getPreviousPage(){return previousPage},notify:notifyAll,notifyCurrentPage:notifyPage,goto:gotoPage,init:initPage}})})(window);(function(global,undefined){'use strict';var modules={};var createAbstractModule=function createAbstractModule(){return{actions:function actions(){},init:function init(){}}};var createModule=function createModule(module){return Object.freeze(Object.assign({},createAbstractModule(),module))};var exportModule=function exportModule(key,module,override){if(typeof key!=="string"){App.log({args:["`key` must be a string",key],fx:"error"})}else if(!!modules[key]&&!override){App.log({args:["Overwriting module key %s is not allowed",key],fx:"error"})}else{modules[key]=createModule(module)}return modules[key]};var resolveActions=function resolveActions(key,data){return Object.keys(modules).map(function resolveAction(k){return App.actions.resolve(modules[k].actions,key,data)}).filter(function(a){return!!a})};var notifyModules=function notifyModules(key,data,cb){var actions=resolveActions(key,data);App.actions.execute(actions,key,data,cb);return this};global.App=Object.assign({},global.App,{modules:{models:function models(){return modules},exports:exportModule,notify:notifyModules,resolve:resolveActions}})})(window);(function(global,undefined){'use strict';var pageModels={};var pageInstances={};var activeRoutes={};var createPageModel=function createPageModel(key,model,override){var factory=function factory(pageData){var modelRef;var _isInited=false;if(_typeof(model)==="object"){modelRef=model}else if(typeof model==="function"){modelRef=model.call(this,key,pageData,override);if(_typeof(modelRef)!=="object"){App.log({args:["The exported page model function must return an object, "+"`%s` given (%s)",_typeof(modelRef),modelRef],fx:"error"});return null}}else{App.log({args:["The exported page model must be an object or a function, "+"`%s` given (%s)",_typeof(model),model],fx:"error"});return null}var getSelector=function getSelector(){return"[data-page-url=\""+pageData.key+"\"]"};var base={actions:function actions(){},init:function init(){},canEnter:function canEnter(){return true},canLeave:function canLeave(){return true},model:function model(){return key},enter:function enter(next,data){var p=document.querySelector(getSelector());p.style.opacity=1;p.style.display="block";if(!!data.firstTime||data.type==="pushState"){window.scrollTo({top:0,left:0,behavior:"auto"})}App.callback(next)},leave:function leave(next){var p=document.querySelector(getSelector());p.style.opacity=0;p.style.display="none";App.callback(next)}};var overwrites=Object.freeze({key:function key(){return pageData.key},selector:function selector(){return getSelector()},data:function data(){return pageData},isInited:function isInited(){return _isInited},setInited:function setInited(){_isInited=true}});return Object.freeze(Object.assign({},base,modelRef,overwrites))};activeRoutes[key]=[];return factory};var createPage=function createPage(pageData,keyModel,override){var pageModel=pageModels[keyModel];var pageInst;if(!pageModel){App.log({args:["Model `%s` not found",keyModel],fx:"error"})}else{if(!!pageInstances[pageData.key]&&!override){App.log({args:["Overwriting page key `%s` is not allowed",pageData.key],fx:"error"})}else{pageInst=pageModel(pageData);if(!!pageInst){pageInstances[pageData.key]=pageInst}return pageInst}}return false};var registerPageModel=function registerPageModel(key,pageModel,override){var keyType=_typeof(key);if(keyType!=="string"){App.log({args:["`key` must be a string, `%s` given (%s).",keyType,key],fx:"error"})}else if(!!pageModels[key]&&!override){App.log({args:["Overwriting page model key `%s` is not allowed",key],fx:"error"})}else{pageModels[key]=Object.freeze(pageModel);return pageModel}return false};var exportPage=function exportPage(key,model,override){var pageModel=createPageModel(key,model,override);return registerPageModel(key,pageModel,override)};var routeMatchStrategies={regexp:function regexp(testRoute,route,cb){if(testRoute.test(route)){return cb()}return true},string:function string(testRoute,route,cb){var regex;route=decodeURIComponent(route);route=route.split("#")[0];if(testRoute===route){return cb()}if(testRoute.indexOf("^")!==0){testRoute="^"+testRoute}if(testRoute.indexOf("^")!==testRoute.length-1){testRoute=testRoute+"$"}if(testRoute.indexOf("*")){testRoute=testRoute.replace(new RegExp("\\*","gi"),".*")}try{regex=new RegExp(testRoute)}catch(ex){App.log({args:["Error while creating RegExp %s.\n%s",testRoute,ex],fx:"error"})}if(!!regex&&regex.test(route)){return cb()}return true}};var matchRoute=function matchRoute(route,routes){var index=-1;var found=function found(i){index=i;return false};if(typeof route!=="string"){App.log({args:"`route` must be a string",fx:"error"});return index}if(!!~route.indexOf("?")){route=route.split("?")[0]}if(!!route&&!!routes){if(!Array.isArray(routes)){routes=Object.values(routes)}routes.every(function matchOneRoute(testRoute,i){var routeType=_typeof(testRoute);var routeStrategy=routeMatchStrategies[routeType];var cb=function cb(){return found(i)};if(typeof routeStrategy==="function"){return routeStrategy(testRoute,route,cb)}else if(testRoute===route){return cb()}return true})}return index};var addRoutes=function addRoutes(keyModel,routes){if(!pageModels[keyModel]){App.log({fx:"error",args:"Model \""+keyModel+"\" not found."});return false}if(!activeRoutes[keyModel]){activeRoutes[keyModel]=[]}if(keyModel==="default"){App.log({fx:"error",args:"You can't add routes to the default model"});return false}activeRoutes[keyModel]=_toConsumableArray(new Set(activeRoutes[keyModel].concat(routes)));return activeRoutes[keyModel]};var removeRoutes=function removeRoutes(keyModel,routes){if(!pageModels[keyModel]){App.log({fx:"error",args:"Model \""+keyModel+"\" not found."});return false}return false};var getPageForHref=function getPageForHref(href){if(!!pageInstances[href]){return pageInstances[href]}href=href.split("#")[0];var model=null;for(var m in activeRoutes){if(activeRoutes.hasOwnProperty(m)){var modelRoutes=activeRoutes[m];var match=!!~matchRoute(href,modelRoutes);if(!!match){model=m;break}}}if(!model){model="default"}return createPage({key:href},model,true)};var loaded=function loaded(url){return!!document.querySelector(App.root()).querySelector("[data-page-url=\""+url+"\"]")};registerPageModel("default",createPageModel("default",{},true),{});global.App=Object.assign({},global.App,{pages:{instances:function instances(key){if(!!key){return pageInstances[key]}return pageInstances},models:function models(){return pageModels},getPageForHref:getPageForHref,page:function page(keyOrRoute){var result=pageInstances[keyOrRoute];if(!!!result){result=getPageForHref(keyOrRoute)}return result},create:createPage,exports:exportPage,loaded:loaded,routes:{active:function active(){return activeRoutes},match:matchRoute,add:addRoutes,remove:removeRoutes}}})})(window);(function(global,undefined){'use strict';var storage=function storage(_storage){return{get:function get(key){if(!key){return}key+="";return _storage[key]},set:function set(key,value){var result=false;if(!!key){key+="";try{_storage[key]=!value?"":value+"";result=true}catch(e){App.log({args:e.message,me:"Storage",fx:"error"});result=false}}return result},remove:function remove(key){var result=false;if(!!key){key+="";try{_storage.removeItem(key);result=true}catch(e){App.log({args:e.message,me:"Storage",fx:"error"});result=false}}return result},clear:function clear(regexp){var result=false;try{if(!regexp){_storage.clear()}else{var remove=[];for(var i=0;i<_storage.length;i++){var key=_storage.key(i);if(regexp.test(key)){remove.push(key)}}for(var _i=0;_i<remove.length;_i++){_storage.removeItem(remove[_i])}}result=true}catch(e){App.log({args:e.message,me:"Storage",fx:"error"});result=false}return result}}};var safeLocalStorage=function safeLocalStorage(){try{return storage(window.localStorage)}catch(e){App.log({args:e.message,me:"Storage",fx:"error"})}return storage({})};var safeSessionStorage=function safeSessionStorage(){try{return storage(window.sessionStorage)}catch(e){App.log({args:e.message,me:"Storage",fx:"error"})}return storage({})};global.App=Object.assign({},global.App,{storage:{factory:storage,local:safeLocalStorage(),session:safeSessionStorage()}})})(window);(function(global,undefined){'use strict';var ROOT="body";var initApplication=function initApplication(root){if(!!root&&!!document.querySelector(root)){ROOT=root}Object.values(App.modules.models()).forEach(function initModule(m){m.init()});var firstPage=App.pages.getPageForHref(window.location.href);if(!!firstPage&&!!App.pages.loaded(firstPage.key())){firstPage.init({firstTime:true});firstPage.setInited();App.mediator.init(firstPage)}Object.values(App.pages.instances()).forEach(function initPage(page){if(!!App.pages.loaded(page.key())&&page.key()!==firstPage.key()){page.init({firstTime:true});page.setInited();App.mediator.init(page)}});App.mediator.notify("app.init",{page:App.mediator.getCurrentPage()});if(!App.mediator.getCurrentPage()){App.modules.notify("app.pageNotFound");App.log({fx:"error",args:"No current page set, pages will not work."})}};var run=function run(root){initApplication(root);return global.App};global.App=Object.assign({},global.App,{root:function root(){return ROOT},run:run})})(window);
