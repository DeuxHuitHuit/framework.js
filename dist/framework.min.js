/*! framework.js - v2.0.0 - 7afd4e1 - build 163 - 2019-04-24
 * https://github.com/DeuxHuitHuit/framework.js
 * Copyright (c) 2019 Deux Huit Huit (https://deuxhuithuit.com/);
 * MIT */
!function(p,e,c){"use strict";var i={},l=!1,g=[];e.App=p.extend(!0,e.App,{actions:{resolve:function(e,r,n){if(p.isFunction(e)&&(e=e()),e){var t=e[r];if(!p.isFunction(t)){var o=i[r]||r.split(".");if(o.length<2)return;i[r]=o,t=e,p.each(o,function(){return t=t[this],!!p.isPlainObject(t)})}if(p.isFunction(t))return t}},execute:function(e,t,o,i){var r,n=0,a=!1;for(l||(a=l=!0),p.isArray(e)||(e=[e]),p.isFunction(o)&&!i&&(i=o,o=c),e.forEach(function(e,r){var n=App.callback(e,[t,o]);i&&n!==c&&App.callback(i,[r,n]),p.isFunction(n)&&(n={read:null,write:n}),p.isPlainObject(n)&&p.isFunction(n.write)&&(App.debug()&&!n.key&&(n.key=t),g.push(n))});a&&g.length>n;){for(var s=g.length,u=n;u<s;u++)r=g[u],p.isFunction(r.read)&&r.read(t,o);for(u=n;u<s;u++)g[u].write(t,o);n=s}a&&(l=!1,g=[])},stack:function(){return g}}})}(jQuery,window),function(l,e,g){"use strict";e.App=l.extend(!0,e.App,{callback:function(e,r){try{if(i=null===(o=r),a=o!==g,s=!l.isArray(o),u=!!o&&!l.isNumeric(o.length),p="string"===l.type(o),c=!!o&&!!o.jquery,(i||a&&s&&(u||p||c))&&(o=[o]),r=o,l.isFunction(e))return e.apply(this,r||[]);if(l.isPlainObject(e))return e}catch(e){var n=e.stack,t=(e.message||e)+"\n"+(n||"");App.log({args:[t,e],fx:"error"})}var o,i,a,s,u,p,c;return g}})}(jQuery,window),function(t,e,r){"use strict";var o={},i=function(e){return t.extend({init:t.noop},e)};e.App=t.extend(!0,e.App,{components:{models:function(){return o},create:function(e,r){if(!o[e])return App.log({args:["Component %s is not found",e],fx:"error"}),i({});var n=o[e];return t.isFunction(n)?i(n.call(n,r)):(App.log({args:["Component %s is not a function",e],fx:"error"}),i({}))},exports:function(e,r,n){if("string"!==t.type(e))App.log({args:["`key` must be a string",e],fx:"error"});else{if(!o[e]||n)return o[e]=r;App.log({args:["Overwriting component key %s is not allowed",e],fx:"error"})}return!1}}})}(jQuery,window),function(e,r,n){"use strict";var t=!1;r.App=e.extend(!0,r.App,{debug:function(e){return!0===e||!1===e?t=e:"!"===e&&(t=!t),t}})}(jQuery,window),function(e,r,n){"use strict";var t,o,i=(t=function(e,r){return r=r||window.navigator.userAgent,e.test(r)},o={isTablet:function(e){return o.isMobile(e)&&!o.isPhone(e)},isTablette:function(e){return this.isTablet(e)},isIos:function(e){return o.isIphone(e)||o.isIpad(e)},isIphone:function(e){return!o.isIpad(e)&&(t(/iPhone/i,e)||t(/iPod/i,e))},isIpad:function(e){return t(/iPad/i,e)},isAndroid:function(e){return t(/Android/i,e)},isAndroidPhone:function(e){return o.isAndroid(e)&&t(/mobile/i,e)},isPhone:function(e){return!o.isIpad(e)&&(o.isOtherPhone(e)||o.isAndroidPhone(e)||o.isIphone(e))},isOtherPhone:function(e){return t(/phone/i,e)},isOtherMobile:function(e){return t(/mobile/i,e)||o.isOtherPhone(e)},isMobile:function(e){return o.isIos(e)||o.isAndroid(e)||o.isOtherMobile(e)},isMsie:function(e){return t(/msie/im,e)||t(/trident/im,e)},isSafari:function(e){return!t(/Chrome/i,e)&&t(/Safari/i,e)},isFirefox:function(e){return t(/Firefox/i,e)},isEdge:function(e){return t(/Edge/i,e)},isChrome:function(e){return t(/Chrome/i,e)&&!o.isEdge()}});r.App=e.extend(!0,r.App,{device:{detector:i,iphone:i.isIphone(),ipad:i.isIpad(),ios:i.isIos(),android:i.isAndroid(),mobile:i.isMobile(),phone:i.isPhone(),tablet:i.isTablet(),chrome:i.isChrome(),firefox:i.isFirefox(),safari:i.isSafari(),internetexplorer:i.isMsie(),edge:i.isEdge(),events:{click:"click",enter:"pointerenter",up:"pointerup",down:"pointerdown",move:"pointermove",over:"pointerover",out:"pointerout",leave:"pointerleave"}}})}(jQuery,window),function(t,e,r){"use strict";var o={};e.App=t.extend(!0,e.App,{fx:{notify:function(e,r,n){var t=o[e];return t?App.actions.execute(t,e,r,n):App.log({args:["Function key %s did not resolve to anything",e],fx:"warn"}),this},exports:function(e,r,n){return"string"!==t.type(e)?App.log({args:["`key` must be a string",e],fx:"error"}):o[e]&&!n?App.log({args:["Overwriting function key %s is not allowed",e],fx:"error"}):t.isFunction(r)?(function(e,r){if(App.debug()&&Object.defineProperty)try{Object.defineProperty(r,"name",{value:e})}catch(e){}}(r),o[e]=r):App.log({args:["Function key %s is not a function",e],fx:"error"}),o[e]}}})}(jQuery,window),function(e,r,n){"use strict";var a=function(e,r,n,t,o){n=Math.max(n||0,100),t=t||10,o=o||1;var i=App.callback(e,[o]);i?setTimeout(function(){App.callback(r,[i,o])},0):o<t?setTimeout(a,n,e,r,n,t,o+1):App.log&&App.log({fx:"error",args:["App.loaded timed out after %s attempts.",o]})};r.App=e.extend(!0,r.App,{loaded:a})}(jQuery,window),function(u,r,e){"use strict";var n;n=u.ajaxSettings.xhr,u.ajaxSetup({progress:u.noop,upload:u.noop,xhr:function(){var r=this,e=n();return e&&(u.isFunction(e.addEventListener)&&e.addEventListener("progress",function(e){r.progress(u.Event(e))},!1),e.upload&&u.isFunction(e.upload.addEventListener)&&e.upload.addEventListener("progress",function(e){r.upload(u.Event(e))},!1)),e}});var p=[],c=!1,i=null,l=function(e){return u.isPlainObject(e)||(e={url:e}),(!e.method||"GET"===e.method)&&(!!i&&i===e.url)},g=function(n){var t=-1;return u.each(p,function(e,r){return r.url!==n||(t=e,!1)}),t},f=function(e){return!0===e.cache&&(e.cache="session"),r.App.storage&&r.App.storage[e.cache]},a=u.noop,s=u.noop,d=function(){var o,e=p.shift(),r=u.extend({},e,(o=e,{progress:function(e){App.callback(o.progress,[e])},success:function(e,r,n){if(i=null,a(),App.callback(o.success,[e,r,n]),o.cache){var t=f(o);t&&t.set(o.url,e)}},error:function(e,r,n){var t=o.vip?2:1;i=null,App.log({fx:"error",args:["Error loading url %s: %s",o.url,r+" "+n],me:"Loader"}),o.priority+=++o.retries,400<=e.status&&e.status<500?App.callback(o.clienterror,[e.status,e,r,n]):o.retries<=o.maxRetries*t?s(o):App.callback(o.giveup,[e,r,n]),a(),App.callback(o.error,[e,r,n])}}));u.ajax(r),i=r.url};a=function(){p.length?setTimeout(d,0):c=!1};s=function(e,r){if(!e)return App.log({fx:"error",args:"No url given",me:"Loader"}),this;var n,t;if(n=e,t=r,u.isPlainObject(n)||(n={url:n}),u.isNumeric(t)&&Math.abs(t)<p.length&&(n.priority=t),(!u.isNumeric(n.priority)||Math.abs(n.priority)>p.length)&&(n.priority=p.length),u.isNumeric(n.retries)||(n.retries=0),u.isNumeric(n.maxRetries)||(n.maxRetries=2),l(e=n))return App.log({fx:"error",args:["Url %s is already loading",e.url],me:"Loader"}),this;if(e.cache&&function(e){var r=f(e);if(r){var n=r.get(e.url);if(n&&!1!==App.callback(e.cachehit,[n]))return App.callback(e.success,[n]),!0}return!1}(e))return this;var o,i,a,s=g(e.url);return~s?(o=e,(a=p[i=s]).priority!=o.priority&&(p.splice(i,1),p.splice(o.priority,1,o)),App.log({args:["Url %s was shifted from %s to %s",o.url,a.priority,o.priority],me:"Loader"})):(p.splice(e.priority,1,e),App.log({fx:"info",args:["Url %s has been insert at %s",e.url,e.priority],me:"Loader"})),c||(c=!0,d(),App.log({fx:"info",args:"Load worker has been started",me:"Loader"})),this},r.App=u.extend(!0,r.App,{loader:{load:s,isLoading:l,inQueue:g,working:function(){return c}}})}(jQuery,window),function(t,e,r){"use strict";var o=[];e.App=t.extend(!0,e.App,{log:function(e){if(!e)return this;var n=function(e){e.args&&!t.isArray(e.args)&&(e.args=[e.args]);var r={args:e.args||arguments,fx:e.fx||"warn",me:e.me||"App"},n=t.type(r.args[0]);return"string"!==n&&"number"!==n&&"boolean"!=n||(r.args[0]="["+r.me+"] "+r.args[0]),r}(e);return App.debug()&&(t.isFunction(console[n.fx])||(n.fx="log"),window.console[n.fx].apply?window.console[n.fx].apply(window.console,n.args):t.each(n.args,function(e,r){window.console[n.fx](r)})),o.push(n),this},logs:function(){return o}})}(jQuery,window),function(g,e,r){"use strict";var i=function(){return document.location.href.substring(document.location.protocol.length+2+document.location.host.length)},f=!1,n=i(),d=null,a=null,s="",t=function(){return f&&App.log({args:"Mediator is busy waiting for a page load.",fx:"error"}),!f},A=function(e){var r=!0;return e||(r=!1),r},v=function(e){var r=!0;return e.canEnter()||(App.log({fx:"error",args:["Cannot enter page %s.",e.key()]}),r=!1),r},u=function(e,r){if(d)return App.actions.resolve(d.actions,e,r);App.log({args:"Can not notify page: No current page set.",fx:"error"})},o=function(u,o){var p,e,c="",l=function(){var e=d,r=function(){d=null,a=e,s=o||i(),e=null,App.modules.notify("page.leave",{page:a})},n=function(){d=p,App.modules.notify("page.enter",{page:p,route:c}),f=!1},t={currentPage:d,nextPage:p,leaveCurrent:r,enterNext:n,route:c,isHandled:!1};App.modules.notify("pages.requestPageTransition",t),p.isInited||(p.init(),p.isInited=!0),t.isHandled||(App.modules.notify("page.leaving",{page:e}),e.leave(r),App.modules.notify("page.entering",{page:p,route:c}),p.enter(n))};return t()&&(e=!1,d?d.canLeave()?e=!0:App.log({args:["Cannot leave page %s.",d.key()],fx:"error"}):App.log({args:"No current page set.",fx:"error"}),e)&&("string"===g.type(u)?(p=App.pages.getPageForRoute(u),c=u):p=u,A(p)?v(p)?p===d?(App.modules.notify("pages.navigateToCurrent",{page:p,route:c}),App.log("Next page is the current one")):(App.modules.notify("pages.loading",{page:p}),App.modules.notify("pages.requestBeginPageTransition",{currentPage:d,nextPage:p,route:c}),p.loaded()?(l(),App.modules.notify("pages.loaded",{elem:g(App.root()),url:u,page:p})):(f=!0,App.loader.load({url:u,priority:0,vip:!0,success:function(e,r,n){var t=function(r){try{return g(r)}catch(e){App.log({args:[e.message],fx:"error"}),App.modules.notify("pages.failedtoparse",{data:r,route:c,nextPage:p,currentPage:d})}return g()}(e),o=t.find(p.key()),i=g(App.root()),a=t.find(App.root()+" > [data-response-url]").attr("data-response-url");if(a&&a!=u.split("#")[0]){var s=p;if(p=App.pages.getPageForRoute(a),App.modules.notify("pages.redirected",{currentPage:d,nextPage:p,redirectedPage:s,requestedRoute:c,responseRoute:a}),App.modules.notify("pages.requestCancelPageTransition",{currentPage:d,nextPage:p,route:c}),!A(p))return App.modules.notify("pages.routeNotFound",{page:d,url:u,isRedirect:!0}),void App.log({args:['Redirected route "%s" was not found.',u],fx:"error"});o=t.find(p.key()),p===d?(App.modules.notify("pages.navigateToCurrent",{page:p,route:c,isRedirect:!0}),App.log("Redirected next page is the current one")):App.modules.notify("pages.requestBeginPageTransition",{currentPage:d,nextPage:p,route:a,isRedirect:!0})}o.length?(i.append(o.css({opacity:0})),p.init(),p.isInited=!0,o.hide(),App.modules.notify("pages.loaded",{elem:i,data:e,url:u,page:p,node:o,xhr:n,status:r}),l()):(App.log({args:['Could not find "%s" in xhr data.',p.key()],fx:"error"}),f=!1,App.modules.notify("pages.notfound",{data:e,url:u,xhr:n,status:r}))},progress:function(e){var r=e.originalEvent.total,n=e.originalEvent.loaded,t=0<r?n/r:0;App.mediator.notify("pages.loadprogress",{event:e,url:u,total:r,loaded:n,percent:t})},error:function(e){App.modules.notify("pages.loaderror",{event:e,url:u})},giveup:function(e){f=!1,App.log({args:"Giving up!",me:"Loader",fx:"error"}),App.modules.notify("pages.loadfatalerror",{event:e,url:u})}}))):App.log({args:['Route "%s" is invalid.',u],fx:"error"}):(App.modules.notify("pages.routeNotFound",{page:d,url:u}),App.log({args:['Route "%s" was not found.',u],fx:"error"}))),this};e.App=g.extend(!0,e.App,{mediator:{getCurrentUrl:i,getCurrentPage:function(){return d},setCurrentPage:function(e){d=e},getPreviousUrl:function(){return s},getPreviousPage:function(){return a},notify:function(e,r,n){var t=[],o=u(e,r);return o&&t.push(o),t=t.concat(App.modules.resolve(e,r)),App.actions.execute(t,e,r,n),this},notifyCurrentPage:function(e,r,n){var t=u(e,r);return t&&App.actions.execute([t],e,r,n),this},goto:o,toggle:function(e,r){if(d&&t()){var n=App.pages.getPageForRoute(e);A(n)&&v(n)&&(n!==d?o(e):s&&s!==i()?o(s):r?o(r):App.modules.notify("page.toggleNoPreviousUrl",{currentPage:n}))}return this},init:function(e){~App.pages.matchRoute(n,e.routes())&&(d&&App.log({args:["Previous current page will be changed",{currentPage:d,previousPage:a,newCurrentPage:e}],fx:"warning"}),d=e,a=a||e,App.modules.notify("page.entering",{page:d,route:n}),d.enter(function(){App.modules.notify("page.enter",{page:d,route:n})}))}}})}(jQuery,window),function(t,e,r){"use strict";var o={},i=function(e){return t.extend({actions:t.noop,init:t.noop},e)},a=function(r,n){return Object.keys(o).map(function(e){return App.actions.resolve(o[e].actions,r,n)}).filter(function(e){return!!e})};e.App=t.extend(!0,e.App,{modules:{models:function(){return o},exports:function(e,r,n){return"string"!==t.type(e)?App.log({args:["`key` must be a string",e],fx:"error"}):o[e]&&!n?App.log({args:["Overwriting module key %s is not allowed",e],fx:"error"}):o[e]=i(r),o[e]},notify:function(e,r,n){var t=a(e,r);return App.actions.execute(t,e,r,n),this},resolve:a}})}(jQuery,window),function(p,e,r){"use strict";var c={},i={},t=function(e){var r=!1;return e?r=!0:App.log({args:"No route set.",fx:"error"}),r},a={regexp:function(e,r,n){if(e.test(r))return n()},string:function(r,e,n){var t;if(r==(e=(e=decodeURIComponent(e)).split("#")[0]))return n();0!==r.indexOf("^")&&(r="^"+r),r.indexOf("^")!==r.length-1&&(r+="$"),r.indexOf("*")&&(r=r.replace(new RegExp("\\*","gi"),".*"));try{t=new RegExp(r)}catch(e){App.log({args:["Error while creating RegExp %s.\n%s",r,e],fx:"error"})}return t&&t.test(e)?n():void 0}},o=function(o,e){var r=-1,i=function(e){return r=e,!1};return"string"!==p.type(o)?App.log({args:"`route` must be a string",fx:"error"}):(~o.indexOf("?")&&(o=o.split("?")[0]),o&&e&&p.each(e,function(e,r){var n=p.type(r),t=a[n];return p.isFunction(t)?t(r,o,function(){return i(e)}):r!==o||i(e)})),r},n=function(r){var n=null;return t(r)&&p.each(i,function(){var e=this.routes();if(~o(r,e))return n=this,!1}),n};e.App=p.extend(!0,e.App,{pages:{matchRoute:o,validateRoute:t,instances:function(e){return e?i[e]:i},models:function(){return c},getPageForRoute:n,page:function(e){var r=i[e];return r||(r=n(e)),r},create:function(e,r,n){var t,o=c[r];if(o){if(!i[e.key]||n)return(t=o(e))&&(i[e.key]=t),t;App.log({args:["Overwriting page key `%s` is not allowed",e.key],fx:"error"})}else App.log({args:["Model `%s` not found",r],fx:"error"});return!1},exports:function(e,r,n){var o,i,a,t,s,u;return function(e,r,n){var t=p.type(e);if("string"!==t)App.log({args:["`key` must be a string, `%s` given (%s).",t,e],fx:"error"});else{if(!c[e]||n)return c[e]=r;App.log({args:["Overwriting page model key `%s` is not allowed",e],fx:"error"})}return!1}(e,(o=e,i=r,a=n,t=function(){return!0},s=function(e){App.callback(e)},u={actions:p.noop,init:p.noop,enter:s,leave:s,canEnter:t,canLeave:t},function(e){var r;if(p.isPlainObject(i))r=i;else{if(!p.isFunction(i))return App.log({args:["The exported page model must be an object or a function, `%s` given (%s)",p.type(i),i],fx:"error"}),null;if(r=i.call(this,o,e,a),!p.isPlainObject(r))return App.log({args:["The exported page model function must return an object, `%s` given (%s)",p.type(r),r],fx:"error"}),null}var n=function(){return e.key},t={key:n,loaded:function(){return!!p(n()).length},routes:function(){return e.routes},data:function(){return e}};return p.extend(!0,{},u,r,t)}),n)}}})}(jQuery,window),function(r,t,e){"use strict";var n,o,i,a=(n=/\+/g,o=/([^&=]+)=?([^&]*)/gi,i=function(e){return decodeURIComponent(e.replace(n," "))},{parse:function(e){var r,n,t={};for(""===e||e||(e=window.location.search),n=e.substring(1);r=o.exec(n);)t[i(r[1])]=i(r[2]);return t},stringify:function(e){var n=[];return r.each(e,function(e,r){r&&n.push(e+"="+t.encodeURIComponent(r))}),n.length?"?"+n.join("&"):""}});t.App=r.extend(!0,t.App,{routing:{querystring:a}})}(jQuery,window),function(e,r,n){"use strict";var t=function(i){return{get:function(e){if(e)return i[e+=""]},set:function(e,r){var n=!1;if(e){e+="";try{i[e]=r?r+"":"",n=!0}catch(e){App.log({args:e.message,me:"Storage",fx:"error"}),n=!1}}return n},remove:function(e){var r=!1;if(e){e+="";try{i.removeItem(e),r=!0}catch(e){App.log({args:e.message,me:"Storage",fx:"error"}),r=!1}}return r},clear:function(e){var r=!1;try{if(e){for(var n=[],t=0;t<i.length;t++){var o=i.key(t);e.test(o)&&n.push(o)}for(t=0;t<n.length;t++)i.removeItem(n[t])}else i.clear();r=!0}catch(e){App.log({args:e.message,me:"Storage",fx:"error"}),r=!1}return r}}};r.App=e.extend(!0,r.App,{storage:{factory:t,local:t(window.localStorage),session:t(window.sessionStorage)}})}(jQuery,window),function(n,t,e){"use strict";var o="body";t.App=n.extend(!0,t.App,{root:function(){return o},run:function(e){var r;return(r=e)&&n(r).length&&(o=r),n.each(App.modules.models(),function(){this.init()}),n.each(App.pages.instances(),function(){this.loaded()&&(this.init({firstTime:!0}),this.isInited=!0,App.mediator.init(this))}),App.mediator.notify("app.init",{page:App.mediator.getCurrentPage()}),App.mediator.getCurrentPage()||(App.modules.notify("app.pageNotFound"),App.log({args:"No current page set, pages will not work.",fx:"error"})),t.App}})}(jQuery,window),function(n,t,e){"use strict";var r;t.App&&t.App.device&&(r=n("html"),["iphone","ipad","ios","android","mobile","phone","tablet","touch","chrome","firefox","safari","internetexplorer","edge"].forEach(function(e){App.device[e]&&r.addClass(e)}),n.easing.def=App.device.mobile?"linear":"easeOutQuad");t.console||(t.console={}),n.each(["assert","clear","count","debug","dir","dirxml","error","group","group","group","info","log","profile","profile","time","time","time","trace","warn"],function(e,r){t.console[r]=t.console[r]||n.noop}),t.pd=function(e,r){return e&&(n.isFunction(e.preventDefault)&&e.preventDefault(),!1!==r&&n.isFunction(e.stopPropagation)&&e.stopPropagation()),!1}}(jQuery,window);
//# sourceMappingURL=framework.min.js.map