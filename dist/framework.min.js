/*! framework.js - v1.0.0 - 2013-01-10
* https://github.com/DeuxHuitHuit/framework.js
* Copyright (c) 2013 Deux Huit Huit; Licensed MIT */
(function(a,b){"use strict";var c=navigator.userAgent;a.unsupported=!a.browser||a.browser.msie&&parseInt(a.browser.version,10)<9,a.iphone=!!c&&(c.match(/iPhone/i)||c.match(/iPod/i)),a.ios=a.iphone||!!c&&c.match(/iPad/i),a.mobile=a.ios||!!c&&(c.match(/Android/i)||c.match(/mobile/i)||c.match(/phone/i))})(jQuery),function(a,b){"use strict",a.mobile&&a("html").addClass("mobile"),a.easing.def=a.mobile?"linear":"easeOutQuad"}(jQuery),function(a,b){"use strict",window.console||(console.log=console.warn=console.error=console.info=console.dir=a.noop)}(jQuery),function(a,b){"use strict";var c=function(a){return("0"+parseInt(a,10).toString(16)).slice(-2)};window.rgb2hex=function(a){var b=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return b?c(b[1])+c(b[2])+c(b[3]):a},window.pd=function(b){return b&&a.isFunction(b.preventDefault)&&b.preventDefault(),!1},window.keys={"?":0,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause_break:19,caps_lock:20,escape:27,space_bar:32,page_up:33,page_down:34,end:35,home:36,left_arrow:37,up_arrow:38,right_arrow:39,down_arrow:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,left_window_key:91,right_window_key:92,select_key:93,numpad_0:96,numpad_1:97,numpad_2:98,numpad_3:99,"numpad 4":100,numpad_5:101,numpad_6:102,numpad_7:103,numpad_8:104,numpad_9:105,multiply:106,add:107,subtract:109,"decimal point":110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,num_lock:144,scroll_lock:145,semi_colon:186,";":186,"=":187,equal_sign:187,comma:188,",":188,dash:189,".":190,period:190,forward_slash:191,"/":191,grave_accent:192,open_bracket:219,back_slash:220,"\\":220,close_braket:221,single_quote:222},window.keyFromCode=function(b){var c="?";return b?(a.each(window.keys,function(a,d){return b==d?(c=a,!1):!0}),c):c}}(jQuery),function(a,b){"use strict";var c=[],d=!1,e=null,f=function(a){return!!e&&e===a},g=function(b){var d=-1;return a.each(c,function(a,c){return c.url===b?(d=a,!1):!0}),d},h=function(){c.length?i():d=!1},i=function(){var b=c.shift(),d=a.extend({},b,{success:function(){e=null,h(),App.callback.call(this,b.success,arguments)},error:function(){e=null,App.log({args:["Error loading url %s",b.url],me:"Loader"}),b.vip||(b.priority+=++b.retries),b.retries<=b.maxRetries&&j(b),h(),App.callback.call(this,b.error,arguments)}});a.ajax(d),e=d.url},j=function(b,e){if(!b)return App.log({args:"No url given",me:"Loader"}),this;a.isPlainObject(b)||(b={url:b}),a.isNumeric(e)&&Math.abs(e)<c.length&&(b.priority=e);if(!a.isNumeric(b.priority)||Math.abs(b.priority)>c.length)b.priority=c.length;a.isNumeric(b.retries)||(b.retries=0),a.isNumeric(b.maxRetries)||(b.maxRetries=2);if(f(b.url))return App.log({args:["Url %s is already loading",b.url],me:"Loader"}),this;var h=g(b.url);if(!~h)c.splice(b.priority,1,b),App.log({args:["Url %s has been insert at %s",b.url,b.priority],me:"Loader"});else{var j=c[h];j.priority!=b.priority&&(c.splice(h,1),c.splice(b.priority,1,b)),App.log({args:["Url %s was shifted from %s to %s",b.url,j.priority,b.priority],me:"Loader"})}return d||(d=!0,i(),App.log({args:"Load worker has been started",me:"Loader"})),this};window.Loader=a.extend(window.Loader,{load:j,isLoading:f,inQueue:g,working:function(){return d}})}(jQuery),function(a,b){"use strict";var c="body",d=null,e=null,f=function(b,c){return a.isFunction(b)?b.apply(this,c):null},g=!1,h=function(a){return a===!0||a===!1?(g=a,this):a==="!"?(g=!g,this):g},i=[],j=function(b){if(g){if(!b)return this;!!b.args&&!a.isArray(b.args)&&(b.args=[b.args]);var c={args:b.args||arguments,fx:b.fx||"warn",me:b.me||"App"},d=a.type(c.args[0]);if(d==="string"||d==="number"||d=="boolean")c.args[0]="["+c.me+"] "+c.args[0];!console||(a.isFunction(console[c.fx])||(c.fx="log"),console[c.fx].apply(console,c.args)),i.push(c)}return this},k={},l=function(){var b=function(){return!0},c=function(){return"abstract"},d=function(){return!!a(this.key()).length},e=function(a){f(a)};return{actions:a.noop,key:c,loaded:d,init:a.noop,enter:e,leave:e,canEnter:b,canLeave:b,routes:a.noop}},m=function(b){return a.extend(l(),b)},n=function(a,b){var c=m(b);return k[a]=c,c},o=function(b,c){var d=-1,e=function(a){return d=a,!1};return!!b&&!!c&&a.each(c,function f(c){var d=this,f=a.type(d);if(f=="regexp"){if(d.test(b))return e(c)}else if(f=="string"){if(d==b)return e(c);d.indexOf("^")!==0&&(d="^"+d),d.indexOf("^")!=d.length-1&&(d=d+"$"),d.indexOf("*")&&(d=d.replace(new RegExp("\\*","g"),"[a-zA-Z0-9_/-?]*"));var g=new RegExp(d);if(g.test(b))return e(c)}else if(d===b)return e(c);return!0}),d},p=function(b){var c=null;return x(b)&&a.each(k,function(){var a=this.routes();return~o(b,a)?(c=this,!1):!0}),c},q={},r=function(){return{actions:a.noop,init:a.noop}},s=function(b){return a.extend(r(),b)},t=function(a,b){var c=s(b);return q[a]=c,c},u=function(b,c,d,e){if(!!b){var g=b[c];if(!a.isFunction(g)&&!!~c.indexOf(".")){g=b;var h=c.split(".");a.each(h,function(){g=g[this];if(!a.isPlainObject(g))return!1})}f(g,[c,d,e])}},v=function(a,b,c){return!d||u(d.actions(),a,b,c),this},w=function(b,c,d){return a.each(q,function(){u(this.actions(),b,c,d)}),this},x=function(a){var b=!1;return a?b=!0:j({args:"No route set.",fx:"error"}),b},y=function(){var a=!0;if(!1)j({args:"Mediator is busy waiting for a page load.",fx:"error"}),a=!1;return a},z=function(a){var b=!0;return a||(b=!1),b},A=function(a){var b=!0;return a.canEnter()||(j("Cannot enter page %s.",a.key()),b=!1),b},B=function(){var a=!1;return d?d.canLeave()?a=!0:j("Cannot leave page %s.",d.key()):j({args:"No current page set.",fx:"error"}),a},C=function(a,b,c){return v(a,b,c),w(a,b,c),this},D=function(b){var f,g="",h=function(){var b=d;w("page.leaving",{page:b}),d.leave(function(){a(b.key()).hide(),e=b,b=null,w("page.leave")}),d=null,w("page.entering",{page:f,route:g}),f.enter(function(){d=f,w("page.enter",{page:f,route:g})})},i=function(b,d,e){var g=a(b).find(f.key());if(!g.length)j({args:['Could not find "%s" in xhr data.',f.key()],fx:"error"});else{var i=a(c);i.append(g.css({opacity:0})),f.init(),g.hide(),w("pages.loaded",{elem:i}),h()}};return typeof b=="string"?B()&&y()&&(f=p(b),g=b):f=b,z(f)?A(f)&&(f===d?j("next page is the current one"):f.loaded()?h():(w("pages.loading"),Loader.load({url:b,priority:0,vip:!0,success:i,error:function(){w("pages.loaderror")}}))):j({args:['Route "%s" was not found.',b],fx:"error"}),this},E=function(a){if(!!d&&y()){var b=p(a);z(b)&&A(b)&&(b!==d?D(a):D(e))}return this},F=function(b){!!b&&!!a(b).length&&(c=b),a.each(q,function(){this.init()}),a.each(k,function(){var a=document.location.pathname;!this.loaded()||(this.init(),!~o(a,this.routes())||(d=this,e=this,w("page.entering",{page:d,route:a}),d.enter(function(){w("page.enter",{page:d,route:a})})))})},G=function(a){return F(a),this};window.App=a.extend(window.App,{root:function(){return c},callback:f,debug:h,run:G,log:j,logs:function(){return i},mediator:{notify:C,"goto":D,toggle:E},pages:{_matchRoute:o,getPageForRoute:p,page:function(a){return a[0]=="/"?p(a):k[a]},create:m,"export":n,notify:v},modules:{create:s,"export":t,notify:w}})}(jQuery);