<!DOCTYPE html public "âœ°"> 
<html lang="en"> 
<head> 
	<meta charset="utf-8" /> 
	<title>framework.js test suite</title> 
	
	<link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.10.0.css" type="text/css"/>
	
	<style type="text/css">

	</style>
	
	<script>
		(function (w, doc,co) {
			// http://stackoverflow.com/questions/901115/get-query-string-values-in-javascript
			var u = {},
				e,
				a = /\+/g,  // Regex for replacing addition symbol with a space
				r = /([^&=]+)=?([^&]*)/g,
				d = function (s) { return decodeURIComponent(s.replace(a, " ")); },
				q = w.location.search.substring(1),
				v = '1.8';

			while (e = r.exec(q)) {
				u[d(e[1])] = d(e[2]);
			}
			
			if (!!u.jquery) {
				v = u.jquery;
			}	

			doc.write('<script src="http://ajax.googleapis.com/ajax/libs/jquery/'+v+'/jquery.js">' + "<" + '/' + 'script>');
			co.log('\nLoading jQuery v' + v + '\n');
		})(window, document, console);
	</script>
</head>
<body>
	<h1 id="qunit-header">framework.js</h1>  
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	
	<script src="http://code.jquery.com/qunit/qunit-1.10.0.js"></script>
	<script src="../src/globals.js"></script>
	<script src="../src/loader.js"></script> 
	<script src="../src/app.js"></script>
	
	<script>
	(function ($, w) {
		
		"use strict";
		
		var 
		
		runTests = function  () {
			
			module('App.debug');
			
			test('Test debug() get/set', function AppDebug() {
				//test for initial value
				ok(!App.debug(), 'App.debug() is false by default'); // Should be false
				
				//Test for set true
				App.debug(true);
				ok(App.debug(), 'Setter and getter of App.debug() work has expected with true set');	//should be true
				ok(!App.debug(false), 'Setter and getter of App.debug() work has expected with false set');	//should be false
				ok(App.debug('!'), 'Setter App.debug("!") work has expected with inverted flag');	//should be true
				
				//Make sure we got verbose for other test
				App.debug(true); // adds verbose
			});

			module('window.BrowserDetector');
			
			test('isUnsupported', function browserDetectorIsUnsupported() {
			
				//test for empty string
				ok(w.BrowserDetector.isUnsupported('') == true,'empty ua is an unsupported');
			
				//test for msie with version 7
				ok(w.BrowserDetector.isUnsupported('Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)') == true,'msie v7 is unsupported');
				
				//test for msie with version 8
				ok(w.BrowserDetector.isUnsupported('Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)') == true,'msie v8 is unsupported');
				
				//test for msie with version 9
				ok(!w.BrowserDetector.isUnsupported('Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)') == true,'msie v9 is supported');
				
			});
			
			test('isIphone', function browserDetectorIsIphoneTest() {
				//test for empty string
				ok(w.BrowserDetector.isIphone('') == false,'empty ua is not an iphone');
				
				//test for iphone regex
				ok(w.BrowserDetector.isIphone('iphone') == true,'iphone text ua is an iphone');
				ok(w.BrowserDetector.isIphone('sdfdg-iphonesdf') == true,'ua contains iphone then is an iphone');
				
				//Test for ipad regex
				ok(w.BrowserDetector.isIphone('ipod') == true,'ipod text ua is an iphone');
				ok(w.BrowserDetector.isIphone('sdfdg-ipodesdf') == true,'ua contains ipod then is an iphone');
			});
			
			//test('is')
			
			module('QueryStringParser');
			
			test('parse',function QSTest() {
				var result;
				
				//Test 1
				result = w.QueryStringParser.parse('?q=test');
				ok(result.q === 'test','parse ?q.test is parsed successfully');
				
				//Test 2
				result = w.QueryStringParser.parse('?q=test&r=2');
				ok(result.q === 'test' && result.r == 2,'parse ?q=test&r=2 is parsed successfully');
			});
			
			module('window');
			
			test('QS',function QSTest() {
				ok($.isPlainObject(w.QS), 'w.QS is plain object');
			});
		
			test('isChar', function isCharTest() {
				ok(w.isChar(w.keys.space_bar), 'space_bar');
				ok(!w.isChar(w.keys.backspace), 'backspace');
				ok(w.isChar(w.keys.a), 'a');
				ok(w.isChar(w.keys.z), 'z');
			});
			
			module('App.modules');
			
			test('notify', function appModuleNotifyTest () {
				var count = 0,
					testModule = {
						actions: function () {
							return {
								test: function () {
									count++;
								}
							}
						}
					};
				App.modules.exports('moduleA', testModule);
				App.modules.exports('moduleB', testModule);
				App.modules.exports('moduleC', testModule);
				App.modules.exports('moduleD', {});
				
				App.modules.notify('test');
				
				equal(count, 3, '3 modules got called');
			});
			
			test('notify - JSON Path', function appModuleNotifyJsonPathTest () {
				var count = 0,
					testModule = {
						actions: function () {
							return {
								JSONPath: {
									test: {
										fx: function () {
											count++;
										}
									}
								}
							}
						}
					};
					
				// erase previous modules
				App.modules.exports('moduleA', testModule);
				App.modules.exports('moduleB', {});
				App.modules.exports('moduleC', {});
				App.modules.exports('moduleD', {});
				
				App.modules.notify('JSONPath.test.fx');
				
				equal(count, 1, '1 modules got called');
			});
			
			
			module('Loader');
			
			test('load', function loaderLoadTest () {
				var count = 0;
				
				Loader
					.load('framework.js.test.html')
					.load({
						url: '1.html',
						success: function () {
							count++; // should not get called
						}
					})
					.load({
						url: '2.html',
						complete: function () {
							count++;
							
							// do let the retries do that
							if (count <= 1) {
								start();
								
								equal(count, 1);
							}
						}
					});
				
				stop();
				
			});
			
			//module('App.pages');
			
			//test('_matchRoute', function appPages_matchRouteTest () {
			//	var routes = { // can also use array
			//		root: '/',
			//		contactFR: '/fr/contact/',
			//		contactEN: '/en/contact/',
			//		wildcard: '/test/*/view',
			//		questionWildcard: '/test/*',
			//		regex: /[ab]/
			//	},
			//	route = '';
			/*
				route = routes.root;
				ok(!!~App.pages._matchRoute(route, routes), route);
				route = routes.contactFR;
				ok(!!~App.pages._matchRoute(route, routes), route);
				route = routes.contactEN;
				ok(!!~App.pages._matchRoute(route, routes), route);
				equal(App.pages._matchRoute(route, routes), 'contactEN', route + ' index');
				route = '///kldkslds';
				ok(!~App.pages._matchRoute(route, routes), '! ' + route);
				route = '/fr/test/super-cheap/view';
				ok(!!~App.pages._matchRoute(route, routes), route + ' widlcard');
				route = '/a';
				ok(!!~App.pages._matchRoute(route, routes), route + ' regexp');
				route = '/b';
				ok(!!~App.pages._matchRoute(route, routes), route + ' regexp');
				route = '/c';
				ok(!~App.pages._matchRoute(route, routes), '! ' + route + ' regexp');
				
				route = '/test/?test=test';
				ok(!!~App.pages._matchRoute(route, routes), route + ' regexp');
				
				route = '/test/article/test-test/';
				ok(!!~App.pages._matchRoute(route, routes), route + ' regexp');
				
				route = '/test/article/test-test/#sasasas';
				ok(!!~App.pages._matchRoute(route, routes), route + ' regexp');
				
				route = '/test/?test[super/\]=test#43434';
				ok(!!~App.pages._matchRoute(route, routes), route + ' regexp');
			});
			
			test('getPageForRoute', function appPages_getPageForRouteTest () {
				App.pages.exports('page1', {
					key: function () { return 'page 1'; },
					routes: function () { return ['page-1']; }
				});
				App.pages.exports('page2', {
					key: function () { return 'page 2'; },
					routes: function () { return ['page-2']; }
				});
				
				var page;
				
				page = App.pages.getPageForRoute(null);
				equal(page, null, 'null page');
				page = App.pages.getPageForRoute('page-1');
				equal(page.key(), 'page 1', 'page 1');
				page = App.pages.getPageForRoute('page-2');
				equal(page.key(), 'page 2', 'page 2');
				page = App.pages.getPageForRoute('page-3');
				equal(page, null, 'page 3');
			});
			
			test('App.pages.exports', function appPages_matchRouteTest () {
				var PageClass = App.pages.exports({
					
				}),
				page = App.pages.create('PageClass', {
					//key: ...
					routes: {}
				});
				
				page.addRoute('/fr/');
				page.addRoutes(['/en/','/es/']);
			});
			*/
			
			
		}; // end run tests
		
		$(w).load(runTests);
		
	})(jQuery, window);
	</script>
</body>
</html>